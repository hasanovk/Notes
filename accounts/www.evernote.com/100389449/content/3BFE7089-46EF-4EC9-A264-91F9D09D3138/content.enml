<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note><div><span style="color: rgb(169, 169, 169);"># Written by KFH:</span><font color="#005493"> karshi.hasanov@utoronto.ca</font></div><div><span style="color: rgb(169, 169, 169);"># Date: November 10, 2010</span></div><div><span style="color: rgb(169, 169, 169);"># Last Modified: August 19, 2017</span></div><div><span style="color: rgb(169, 169, 169);"># Description: Installing the custom FreeBSD kernel</span></div><div><span style="color: rgb(169, 169, 169);"># VMware Fusion (ver 8.5.8 ) on Mac OSX ( ver 10.11.6)</span></div><div><span style="color: rgb(169, 169, 169);"># VM FreeBSD - 11.1 </span></div><div><span style="font-size: 24px; font-weight: bold;">The Custom Kernel Installation</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Require : The full FreeBSD source tree</span></div><div>=&gt;<span style="font-weight: bold;"> ls</span><span style="color: rgb(148, 17, 0);"> /usr/src </span><span style="color: rgb(146, 146, 146);"> ( if empty, you don’t have the FreeBSD sources installed)</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Find out your architecture:</span></div><div>=&gt;<span style="font-weight: bold;"> uname</span> <span style="color: rgb(255, 64, 255);">-a</span> </div><div>      … GENERIC amd64</div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Change pwd to the location of the kernel configurations folder</span></div><div>=&gt;<span style="font-weight: bold;"> cd</span> <span style="color: rgb(148, 17, 0);">/usr/src/sys/amd64/conf </span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Copy the default kernel GENERIC to your custom kernel</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span><span style="font-weight: bold;"> cp</span> <span style="color: rgb(0, 150, 255);">GENERIC</span> <span style="color: rgb(0, 143, 0);">KFH</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Edit the custom kernel (KFH) and change to your needs.</span></div><div><span style="color: rgb(146, 146, 146);"># Read the  </span><span style="color: rgb(146, 146, 146); font-weight: bold;">/usr/src/sys/amd64/conf/NOTES </span><span style="color: rgb(146, 146, 146);"> for more details</span></div><div><span style="color: rgb(146, 146, 146);"># Read my notes below “How Do I know all the installed Hardware?" </span></div><div><span style="color: rgb(146, 146, 146);"># </span><span style="color: rgb(255, 38, 0);">IMPORTANT: </span><span style="color: rgb(146, 146, 146);"> </span><span style="color: rgb(255, 38, 0);">Don’t forget to change the name of the custom kernel.</span></div><div><span style="color: rgb(4, 51, 255);">ident </span><span style="color: rgb(0, 144, 81);">KFH</span></div><div><br /></div><div><span style="color: rgb(169, 169, 169);"># Building the custom kernel</span></div><div>=&gt; <span style="font-weight: bold;">cd</span> <span style="color: rgb(148, 17, 0);">/usr/src</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span> <span style="font-weight: bold;">make buildkernel KERNCONF=</span><span style="color: rgb(0, 143, 0); font-style: italic; font-weight: bold;">KFH</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Install the new kernel associated with the specified kernel configuration file. </span></div><div><span style="color: rgb(146, 146, 146);"># This command will copy the new kernel to /boot/kernel/kernel </span></div><div><span style="color: rgb(146, 146, 146);"># and save the old kernel to /boot/kernel.old/kernel:</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span>  <span style="font-weight: bold;">make installkernel KERNCONF=</span><span style="color: rgb(0, 143, 0); font-style: italic; font-weight: bold;">KFH</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Shutdown the system and reboot into the new kernel. If something goes wrong, </span></div><div><span style="color: rgb(146, 146, 146);"># refer to </span><a href="https://www.freebsd.org/doc/handbook/kernelconfig-trouble.html#kernelconfig-noboot" style="color: rgb(146, 146, 146);">The kernel does not boot</a><span style="color: rgb(146, 146, 146);">.</span></div><div><br /></div><div><span style="font-size: 24px; font-weight: bold;">How Do I know all the installed Hardware?</span></div><div><br /></div><div><span style="color: rgb(145, 145, 145);"># --------------------- Hard Disk and CD/DWD -------------------</span></div><div><span style="color: rgb(145, 145, 145);"># SCSI Hard Disk - starts with “da” —&gt; /dev/da0, /dev/da1 ...</span></div><div><span style="color: rgb(145, 145, 145);"># SCSI CDROM/RW/DVD -starts with “cd”  —&gt; /dev/cd0, /dev/cd1, ...</span></div><div>=&gt; <span style="font-weight: bold;">egrep</span> 'ad[0-9]|cd[0-9]|da[0-9]'<span style="color: rgb(148, 17, 0);"> /var/run/</span><span style="color: rgb(148, 33, 147);">dmesg.boot</span> </div><div><span style="color: rgb(146, 144, 0);">da0: &lt;VMware, VMware Virtual S 1.0&gt; Fixed Direct Access SCSI-2 device</span></div><div><span style="color: rgb(146, 144, 0);">cd0: &lt;NECVMWar VMware IDE CDR10 1.00&gt; Removable CD-ROM SCSI device</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># We can use the “camcontrol” command to list the devices:</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span><span style="font-weight: bold;"> camcontrol</span> <span style="color: rgb(148, 55, 255);">devlist</span></div><div><span style="color: rgb(146, 144, 0);">&lt;NECVMWar VMware IDE CDR10 1.00&gt;   at scbus1 target 0 lun 0 (cd0,pass0)</span></div><div><span style="color: rgb(146, 144, 0);">&lt;VMware, VMware Virtual S 1.0&gt;     at scbus2 target 0 lun 0 (pass1,da0)</span></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># ——————————— CPU Information ———————————</span></div><div>=&gt; grep -i cpu /var/run/dmesg.boot</div><div><span style="color: rgb(146, 144, 0);">CPU: Intel(R) Core(TM) i5-4570 CPU @ 3.20GHz (3192.72-MHz K8-class CPU)</span></div><div><span style="color: rgb(146, 144, 0);">FreeBSD/SMP: Multiprocessor System Detected: 2 CPUs</span></div><div><span style="color: rgb(146, 144, 0);">SMP: AP CPU #1 Launched!</span></div><div><br /></div><div>=&gt; sysctl -a | egrep -i 'hw.machine|hw.model|hw.ncpu’</div><div><span style="color: rgb(146, 144, 0);">hw.machine: amd64</span></div><div><span style="color: rgb(146, 144, 0);">hw.model: Intel(R) Core(TM) i5-4570 CPU @ 3.20GHz</span></div><div><span style="color: rgb(146, 144, 0);">hw.ncpu: 2</span></div><div><br /></div><div><span style="color: rgb(169, 169, 169);"># ————— Network Card, Multimedia, Video Card and other USB devices —————— </span></div><div>=&gt; <span style="font-weight: bold;">pciconf </span><span style="color: rgb(148, 55, 255);">-lv</span></div><div><span style="color: rgb(146, 144, 0);">em0@pci0:2:1:0:class=0x020000 card=0x075015ad chip=0x100f8086 rev=0x01 hdr=0x00</span></div><div><span style="color: rgb(146, 144, 0);">    vendor     = 'Intel Corporation'</span></div><div><span style="color: rgb(146, 144, 0);">    device     = '82545EM Gigabit Ethernet Controller (Copper)'</span></div><div><span style="color: rgb(146, 144, 0);">    class      = network</span></div><div><br /></div><div><span style="color: rgb(146, 144, 0);">pcm0@pci0:2:2:0:class=0x040100 card=0x13711274 chip=0x13711274 rev=0x02 hdr=0x00</span></div><div><span style="color: rgb(146, 144, 0);">    vendor     = 'Ensoniq'</span></div><div><span style="color: rgb(146, 144, 0);">    device     = 'ES1371/ES1373 / Creative Labs CT2518'</span></div><div><span style="color: rgb(146, 144, 0);">    class      = multimedia</span></div><div><span style="color: rgb(146, 144, 0);">    subclass   = audio</span></div><div><br /></div><div><span style="color: rgb(146, 144, 0);">vgapci0@pci0:0:15:0:class=0x030000 card=0x040515ad chip=0x040515ad rev=0x00 hdr=0x00</span></div><div><span style="color: rgb(146, 144, 0);">    vendor     = 'VMware'</span></div><div><span style="color: rgb(146, 144, 0);">    device     = 'SVGA II Adapter'</span></div><div><span style="color: rgb(146, 144, 0);">    class      = display</span></div><div><span style="color: rgb(146, 144, 0);">    subclass   = VGA</span></div><div><br /></div><div>...</div><div><br /></div><div><br /></div><div><br /></div><div><br /></div></en-note>