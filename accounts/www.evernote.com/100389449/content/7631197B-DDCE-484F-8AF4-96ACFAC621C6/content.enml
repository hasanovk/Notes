<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div><font color="#a9a9a9"># Written by KFH: <a style="color: rgb(146, 144, 0);" href="mailto:karshi.hasanov@utoronto.ca">karshi.hasanov@utoronto.ca</a></font></div><div><font color="#a9a9a9"># Date: November 10, 2010</font></div><div><font color="#a9a9a9"># Last Modified: August 19, 2017</font></div><div><font color="#a9a9a9"># Description: Installing the custom FreeBSD kernel</font></div><div><font color="#a9a9a9"># VMware Fusion (ver 8.5.8 ) on Mac OSX ( ver 10.11.6)</font></div><div><font color="#a9a9a9"># VM FreeBSD - 11.1 </font></div><div><span style="font-weight: bold; font-size: 24px;">The Custom Kernel Installation</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Require : The full FreeBSD source tree</span></div><div>=&gt;<span style="font-weight: bold;"> ls</span><span style="color: rgb(148, 17, 0);"> /usr/src </span><span style="color: rgb(146, 146, 146);"> ( if empty, you don’t have the FreeBSD sources installed)</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Find out your architecture:</span></div><div>=&gt;<span style="font-weight: bold;"> uname</span> <span style="color: rgb(255, 64, 255);">-a</span> </div><div>      … GENERIC amd64</div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Change pwd to the location of the kernel configurations folder</span></div><div>=&gt;<span style="font-weight: bold;"> cd</span> <span style="color: rgb(148, 17, 0);">/usr/src/sys/amd64/conf </span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Copy the default kernel GENERIC to your custom kernel</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span><span style="font-weight: bold;"> cp</span> <span style="color: rgb(0, 150, 255);">GENERIC</span> <span style="color: rgb(0, 143, 0);">KFH</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Edit the custom kernel (KFH) and change to your needs.</span></div><div><span style="color: rgb(146, 146, 146);"># Read the  </span><span style="color: rgb(146, 146, 146); font-weight: bold;">/usr/src/sys/amd64/conf/NOTES </span><span style="color: rgb(146, 146, 146);"> for more details</span></div><div><font style="color: rgb(146, 146, 146);"># Read my notes below “How Do I know all the installed Hardware?&quot; </font></div><div><span style="color: rgb(146, 146, 146);"># </span><span style="color: rgb(255, 38, 0);">IMPORTANT: </span><span style="color: rgb(146, 146, 146);"> </span><span style="color: rgb(255, 38, 0);">Don’t forget to change the name of the custom kernel.</span></div><div><span style="color: rgb(4, 51, 255);">ident </span><span style="color: rgb(0, 144, 81);">KFH</span></div><div><br/></div><div><span style="color: rgb(169, 169, 169);"># Building the custom kernel</span></div><div>=&gt; <span style="font-weight: bold;">cd</span> <span style="color: rgb(148, 17, 0);">/usr/src</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span> <span style="font-weight: bold;">make buildkernel KERNCONF=</span><span style="font-weight: bold; font-style: italic; color: rgb(0, 143, 0);">KFH</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Install the new kernel associated with the specified kernel configuration file. </span></div><div><span style="color: rgb(146, 146, 146);"># This command will copy the new kernel to /boot/kernel/kernel </span></div><div><span style="color: rgb(146, 146, 146);"># and save the old kernel to /boot/kernel.old/kernel:</span></div><div>=&gt;<span style="color: rgb(255, 38, 0);"> sudo</span>  <span style="font-weight: bold;">make installkernel KERNCONF=</span><span style="font-weight: bold; font-style: italic; color: rgb(0, 143, 0);">KFH</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"># Shutdown the system and reboot into the new kernel. If something goes wrong, </span></div><div><span style="color: rgb(146, 146, 146);"># refer to </span><a style="color: rgb(146, 146, 146);" href="https://www.freebsd.org/doc/handbook/kernelconfig-trouble.html#kernelconfig-noboot">The kernel does not boot</a><span style="color: rgb(146, 146, 146);">.</span></div><div><span style="color: rgb(146, 146, 146);"><br/></span></div><div><b><font style="font-size: 24px;">How Do I know all the installed Hardware?</font></b></div><div><br/></div><div><font color="#919191"># --------------------- Hard Disk and CD/DWD -------------------</font></div><div><font color="#919191"># SCSI Hard Disk - starts with “da” —&gt; /dev/da0, /dev/da1 ...</font></div><div><font color="#919191"># SCSI CDROM/RW/DVD -starts with “cd”  —&gt; /dev/cd0, /dev/cd1, ...</font></div><div>=&gt; <b>egrep</b> 'ad[0-9]|cd[0-9]|da[0-9]'<font color="#941100"> /var/run/</font><font color="#942193">dmesg.boot</font> </div><div><font color="#929000">da0: &lt;VMware, VMware Virtual S 1.0&gt; Fixed Direct Access SCSI-2 device</font></div><div><font color="#929000">cd0: &lt;NECVMWar VMware IDE CDR10 1.00&gt; Removable CD-ROM SCSI device</font></div><div><br/></div><div><font color="#929292"># We can use the “camcontrol” command to list the devices:</font></div><div>=&gt;<font color="#ff2600"> sudo</font><b> camcontrol</b> <font color="#9437ff">devlist</font></div><div><span><font color="#929000">&lt;NECVMWar VMware IDE CDR10 1.00&gt;   at scbus1 target 0 lun 0 (cd0,pass0)</font></span></div><div><span><font color="#929000">&lt;VMware, VMware Virtual S 1.0&gt;     at scbus2 target 0 lun 0 (pass1,da0)</font></span></div><div><br/></div><div><font color="#929292"># ——————————— CPU Information ———————————</font></div><div>=&gt; grep -i cpu /var/run/dmesg.boot</div><div><span><font color="#929000">CPU: Intel(R) Core(TM) i5-4570 CPU @ 3.20GHz (3192.72-MHz K8-class CPU)</font></span></div><div><span><font color="#929000">FreeBSD/SMP: Multiprocessor System Detected: 2 CPUs</font></span></div><div><span><font color="#929000">SMP: AP CPU #1 Launched!</font></span></div><div><br/></div><div>=&gt; sysctl -a | egrep -i 'hw.machine|hw.model|hw.ncpu’</div><div><span><font color="#929000">hw.machine: amd64</font></span></div><div><span><font color="#929000">hw.model: Intel(R) Core(TM) i5-4570 CPU @ 3.20GHz</font></span></div><div><span><font color="#929000">hw.ncpu: 2</font></span></div><div><br/></div><div><font color="#a9a9a9"># ————— Network Card, Multimedia, Video Card and other USB devices —————— </font></div><div>=&gt; <b>pciconf </b><font color="#9437ff">-lv</font></div><div><font color="#929000"><span>em0@pci0:2:1:0:</span><span>class=0x020000 card=0x075015ad chip=0x100f8086 rev=0x01 hdr=0x00</span></font></div><div><span><font color="#929000">    vendor     = 'Intel Corporation'</font></span></div><div><span><font color="#929000">    device     = '82545EM Gigabit Ethernet Controller (Copper)'</font></span></div><div><span><font color="#929000">    class      = network</font></span></div><div><span><font color="#929000"><br/></font></span></div><div><font color="#929000"><span>pcm0@pci0:2:2:0:</span><span>class=0x040100 card=0x13711274 chip=0x13711274 rev=0x02 hdr=0x00</span></font></div><div><span><font color="#929000">    vendor     = 'Ensoniq'</font></span></div><div><span><font color="#929000">    device     = 'ES1371/ES1373 / Creative Labs CT2518'</font></span></div><div><span><font color="#929000">    class      = multimedia</font></span></div><div><span><font color="#929000">    subclass   = audio</font></span></div><div><font color="#929000"><br/></font></div><div><font color="#929000"><span>vgapci0@pci0:0:15:0:</span><span>class=0x030000 card=0x040515ad chip=0x040515ad rev=0x00 hdr=0x00</span></font></div><div><span><font color="#929000">    vendor     = 'VMware'</font></span></div><div><span><font color="#929000">    device     = 'SVGA II Adapter'</font></span></div><div><span><font color="#929000">    class      = display</font></span></div><div><span><font color="#929000">    subclass   = VGA</font></span></div><div><br/></div><div>...</div><div><br/></div><div><br/></div><div><br/></div><div><span style="color: rgb(146, 146, 146);"><br/></span></div></en-note>
