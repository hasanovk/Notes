<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div><b><font style="font-size: 36px;">Apache 2.4 Server on FreeBSD</font></b></div><div><br/></div><div><font style="font-size: 24px;"><span style="font-weight: bold;"> </span><span style="font-weight: bold;">Installation</span></font><br/></div><div>=&gt; <span style="font-weight: bold;">cd </span><font color="#941100">/usr/ports/www/apache24 </font></div><div>=&gt;  <span style="font-weight: bold;">sudo make install </span> </div><div>(leave the default options).</div><div><font color="#797979">If this is not your first installation, you might need to clean the old one:</font></div><div><font color="#797979">=&gt; sudo make clean &amp;&amp; sudo make rmconfig</font></div><div><br/></div><div>Add the line <span style="font-weight: bold;">apache24_enable</span>='<span style="font-weight: bold;">YES</span>' in your /etc/rc.conf file</div><div><br/></div><div><font style="font-size: 24px;"><span style="font-weight: bold;">Configuring the main  </span><span style="font-weight: bold; color: rgb(148, 17, 0);">httpd.conf </span><span style="font-weight: bold;">File</span></font></div><div><br/></div><div>Open the <span style="color: rgb(148, 17, 0);">/usr/local/etc/apache24/httpd.conf</span> file and check the following settings:</div><div><br/></div><div><span style="font-weight: bold;">ServerAdmin </span><a style="font-style: italic;" href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a></div><div><span style="font-weight: bold;">DocumentRoot </span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-style: italic;">“</span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-style: italic;">/opt/hosting/</span><a style="color: rgb(148, 17, 0); font-style: italic;" href="http://www.karshi.ca">www.karshi.ca</a><span style="color: rgb(148, 17, 0); font-style: italic;">”</span>  </div><div># Default location of website </div><div><br/></div><div><span style="font-weight: bold;">&lt;Directory</span> &quot;/opt/hosting/<a href="http://www.karshi.ca">www.karshi.ca</a> &quot;<span style="font-weight: bold;">&gt;</span></div><div># These are defaults. </div><div><span style="font-weight: bold;">   </span><span style="font-weight: bold; color: rgb(148, 17, 0);"> </span><span style="font-weight: bold; color: rgb(148, 17, 0);">Options</span> Indexes FollowSymLinks</div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(148, 17, 0);">AllowOverride</span> None</div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(148, 17, 0);">Require</span> all granted</div><div><span style="font-weight: bold;">&lt;/Directory&gt;</span></div><div><br/></div><div><font style="font-size: 24px;"><span style="font-weight: bold;">Initial</span><span style="font-weight: bold;"> Testing</span></font></div><div>- Create a test file under the <span style="font-weight: bold;">DocumentRoot </span>folder</div><div>  ( /opt/hosting/www.<a href="http://karshi.ca/">karshi.ca/</a>index.html)</div><div><br/></div><div>- Restart the server:</div><div>.=&gt; <span style="font-weight: bold;">sudo</span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-weight: bold;">/usr/local/etc/rc.d/</span><span style="font-weight: bold; color: rgb(148, 17, 0);">apache24</span><span style="font-weight: bold; color: rgb(0, 143, 0);"> </span><span style="color: rgb(0, 143, 0); font-weight: bold; font-style: italic;">onestart</span><span style="color: rgb(0, 143, 0); font-weight: bold;">  </span>( only if you are starting first time !)</div><div>- Visit the website  <a href="http://karshi.ca">http://karshi.ca</a>  or <a href="http://IP_Address">http://IP_Address</a></div><div>  </div><div>- Watch the log file</div><div>=&gt;<span style="font-weight: bold;"> tail </span>-f <span style="color: rgb(148, 17, 0);">/var/log/&lt;website&gt;</span><span style="color: rgb(148, 17, 0); font-weight: bold;">-access.log</span> </div><div>=&gt; tail -f <span style="color: rgb(148, 17, 0);">/var/log/&lt;website&gt;</span><span style="color: rgb(148, 17, 0); font-weight: bold;">-error.log</span></div><div><br/></div><div><font style="font-size: 24px;"><span style="font-weight: bold;"> </span><span style="font-weight: bold;">Setting Up The Virtual Hosts</span></font></div><div><br/></div><div># Most of the time, we will need to host multiple web sites, so let us include (enable)</div><div># the Virtual Host File (its in the Supplemental Configuration Session):</div><div><span style="font-weight: bold;">Include</span> </div><div><font color="#945200"> etc/apache24/extra/httpd-vhosts.conf</font></div><div># Note: If you use the Virtual Hosts, the Apache will ignore the DocumentRoot Directory.</div><div># Instead, it will default to the first (top) Virtual Host </div><div><br/></div><div> </div><div><span style="font-weight: bold;">&lt;VirtualHost *:80&gt;</span></div><div>    # e-mail for the server admin</div><div>    <span style="font-weight: bold;">ServerAdmin</span> <a href="mailto:karshi.hasanov@icloud.com">karshi.hasanov@icloud.com</a></div><div>    # Top directory where the files for this virtual hosts are</div><div>    <span style="font-weight: bold;">DocumentRoot</span> &quot;/opt/hosting/<a href="http://www.karshi.ca">www.karshi.ca</a>&quot;</div><div>    # The server URL for the public. Make sure it's in DNS (local and ISP )</div><div>    <span style="font-weight: bold;">ServerName</span> <a href="http://www.karshi.ca">www.karshi.ca</a></div><div>    # All the errors with the config files, server misconfiguirations etc. are logged here</div><div>    ErrorLog &quot;/var/log/<a href="http://www.karshi.ca">www.karshi.ca</a><span style="font-weight: bold;">-error.log</span>&quot;</div><div>    # This is the access log in common format. </div><div>    <span style="font-weight: bold;">CustomLog</span> &quot;/var/log/<a href="http://www.karshi.ca">www.karshi.ca</a><span style="font-weight: bold;">-access.log</span>&quot; common</div><div>    # Use this to give access to the servers.</div><div>    <span style="font-weight: bold;">&lt;Directory</span> &quot;/opt/hosting/<a href="http://www.karshi.ca">www.karshi.ca</a>&quot;&gt;</div><div>        <span style="font-weight: bold;">Options</span> All</div><div>        <span style="font-weight: bold;">AllowOverride</span> All</div><div>        # The syntax is case sensitive!</div><div>        <span style="font-weight: bold;">Require</span> all granted</div><div>     <span style="font-weight: bold;">&lt;/Directory&gt;</span></div><div><span style="font-weight: bold;">&lt;/VirtualHost&gt;</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; text-decoration: underline;"> </span></div><div><span style="font-weight: bold; text-decoration: underline;">Setting Up HTTPS (SSL Support)</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-style: italic; text-decoration: underline;">Required modules:</span> &quot;<span style="font-weight: bold;">mod_log_config</span>&quot;, &quot;<span style="font-weight: bold;">mod_ss</span>l&quot;, &quot;<span style="font-weight: bold;">so cache_shmcb_module</span>&quot;</div><div>We will be using the &quot;self-issued&quot; or &quot;self-signed&quot; certificate here. To see how to generate the</div><div>self-signed Certificate, please see my notes below: &quot;<span style="font-weight: bold;">How To Create Self-signed Certificates</span>&quot;.</div><div><br/></div><div><span style="font-weight: bold;">Step 1:</span></div><div> Edit the file  &quot;<span style="font-weight: bold; font-style: italic;">/usr/local/etc/apache24/httpd.conf </span>&quot; and enable the modules:</div><div><br/></div><div><span style="font-weight: bold;">LoadModule </span>socache_shmcb_module libexec/apache24/<a style="font-weight: bold;" href="http://mod_socache_shmcb.so">mod_socache_shmcb.so</a></div><div># This module provides for creation and access to a cache backed by a high-performance </div><div>        # cyclic buffer inside a shared memory segment.</div><div><br/></div><div><span style="font-weight: bold;">          LoadModule </span>log_config_module libexec/apache24/<a style="font-weight: bold;" href="http://mod_log_config.so">mod_log_config.so</a></div><div><span style="font-weight: bold;">  </span></div><div># Allows flexible logging of client requests in a customizable format.</div><div><br/></div><div><span style="font-weight: bold;">LoadModule </span>ssl_module libexec/apache24/<a style="font-weight: bold;" href="http://mod_ssl.so">mod_ssl.so</a></div><div><span style="font-weight: bold;">  </span></div><div># This module provides SSL v3 and TLS v1.x support for the Apache HTTP Server. </div><div>        #  SSL v2 is no longer supported.</div><div><br/></div><div><br/></div><div>        # Uncomment the line:</div><div><span style="font-weight: bold;">Include</span> etc/apache24/extra/<span style="font-weight: bold;">httpd-ssl.conf</span></div><div><br/></div><div><span style="font-weight: bold;">Step 2: </span></div><div>Editing the file &quot;<span style="font-weight: bold; font-style: italic;">/usr/local/etc/apache24/extra/httpd-ssl.conf </span><span style="font-weight: bold;">&quot;</span></div><div><br/></div><div><span style="font-weight: bold;">&lt;VirtualHost _default_:443&gt;</span></div><div><span style="font-weight: bold;">DocumentRoot </span></div><div>&quot;/opt/hosting/www.<a href="http://karshi.ca">karshi.ca</a>&quot;</div><div><br/></div><div><span style="font-weight: bold;">  ServerName</span> </div><div><a href="http://www.karshi.ca:443">www.karshi.ca:443</a></div><div><br/></div><div><span style="font-weight: bold;">  ServerAdmin</span> </div><div><a href="mailto:karshi.hasanov@icloud.com">karshi.hasanov@icloud.com</a></div><div><br/></div><div><span style="font-weight: bold;">  ErrorLog</span> </div><div>&quot;/var/log/ssl_www.karhsi.ca-error.log&quot;</div><div><br/></div><div><span style="font-weight: bold;">  TransferLog</span></div><div> &quot;/var/log/ssl_www.karshi.ca-access.log&quot;</div><div><br/></div><div><br/></div><div>                #   Enable/Disable SSL for this virtual host.</div><div><span style="font-weight: bold;">    SSLEngine</span></div><div> on</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">    SSLCertificateFile</span> </div><div>&quot;/etc/KFH_Certs/webserver/server.crt</div><div>&quot;</div><div><span style="font-weight: bold;">    SSLCertificateKeyFile</span> </div><div>&quot;/etc/KFH_Certs/webserver/server.key&quot;</div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">    &lt;Directory</span> </div><div>&quot;/opt/hosting/scripts/cgi-bin&quot;</div><div>&gt;    &lt;-- don't forget to create this folder</div><div>    SSLOptions +StdEnvVars</div><div><span style="font-weight: bold;">    &lt;/Directory&gt;</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">                   CustomLog </span>&quot;</div><div>/var/log/<a href="http://ssl_karshi.ca">ssl_karshi.ca</a></div><div><span style="font-weight: bold;">-request.log</span>&quot; \</div><div>                                 &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;</div><div><br/></div><div><span style="font-weight: bold;">&lt;/VirtualHost&gt;</span></div><div><br/></div><div><span style="font-weight: bold; text-decoration: underline;">How To Create a Self-signed Certificate:</span></div><div><span style="font-weight: bold;">Step 1</span>: Make a directory where you want to keep all your Certificates</div><div>        =&gt; <span style="font-weight: bold;">sudo</span> <span style="font-weight: bold;">mkdir</span> <span style="font-weight: bold;">-p</span> </div><div>/etc/KFH_Certs/webserver</div><div><br/></div><div>=&gt;<span style="font-weight: bold;"> cd</span> </div><div>/etc/KFH_Certs/webserver</div><div><br/></div><div>        <span style="font-weight: bold;">Step 2</span>: Generate the keys</div><div>        =&gt; <span style="font-weight: bold;">sudo openssl genrsa -out</span> </div><div>server.key</div><div> 1024</div><div>=&gt;<span style="font-weight: bold;"> sudo openssl req -new -key</span> </div><div>server.key <span style="font-weight: bold;">-out</span> server.csrCountry Name (2 letter code) [AU]:CA </div><div>State or Province Name (full name) [Some-State]:Ontario </div><div>Locality Name (eg, city) []:Toronto </div><div>Organization Name (eg, company) [Internet Widgits Pty Ltd]:KFH Inc. </div><div>Organizational Unit Name (eg, section) []:Technology Dept. </div><div>Common Name (e.g. server FQDN or YOUR name) []:<a href="http://www.karshi.ca">www.karshi.ca</a> </div><div>Email Address []:<a href="mailto:karshi.hasanov@icloud.com">karshi.hasanov@icloud.com</a> </div><div>        Please enter the following 'extra' attributes to be sent with your certificate request </div><div>A challenge password []: <span style="font-weight: bold;">&lt;Enter&gt;</span></div><div>An optional company name []:<span style="font-weight: bold;"> &lt;Enter&gt;</span></div><div><br/></div><div> </div><div><span style="font-weight: bold;">Step 3</span>: Sign the Certificate</div><div>=&gt;<span style="font-weight: bold;">sudo openssl x509 -req -days 3650 -in</span> </div><div>server.csr <span style="font-weight: bold;">-signkey</span> server.key <span style="font-weight: bold;">-out </span>server.crt</div><div><br/></div></en-note>
