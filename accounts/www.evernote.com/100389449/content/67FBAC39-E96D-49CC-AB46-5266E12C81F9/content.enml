<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note><div>VPN Ports</div><div><br /></div><div><span style="font: 12.0px Helvetica;">VPN Ports</span></div><div><span style="font: 12.0px Verdana;">Little Background: Microsoft RRAS server and VPN client supports PPTP, L2TP/IPSec, SSTP and IKEv2  based VPN connection. PPTP control path is over TCP and data path over GRE. L2TP tunnel traffic is carried over IPSec transport mode and IPSec protocol internally has a control path through IKE and data path over ESP. SSTP control and data path is over TCP. IKEv2 control path is over IKE and data path over ESP.</span></div><div><span style="font: 12.0px Verdana;">So now coming back to original question. There are multiple scenarios:</span></div><div><span style="font: 12.0px Verdana;">1) If </span><span style="font: 12.0px Verdana; text-decoration: underline;">RRAS based VPN server is behind a firewall</span><span style="font: 12.0px Verdana;"> (i.e. a firewall is placed between Internet and RRAS server), then following ports need to be opened (bidirectional) on this firewall to allow VPN traffic to pass through: -</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For PPTP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=TCP, TCP Port number=1723   &lt;- Used by PPTP control path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=GRE (value 47)   &lt;- Used by PPTP data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For L2TP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=500    &lt;- Used by IKEv1 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=4500   &lt;- Used by IKEv1 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=ESP (value 50)   &lt;- Used by IPSec data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For SSTP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=TCP, TCP Port number=443   &lt;- Used by SSTP control and data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For IKEv2:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=500    &lt;- Used by IKEv2 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=4500   &lt;- Used by IKEv2 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=ESP (value 50)   &lt;- Used by IPSec data path</span></div><div><span style="font: 12.0px Verdana;">2) </span><span style="font: 12.0px Verdana; text-decoration: underline;">If RRAS server is directly connected to Internet</span><span style="font: 12.0px Verdana;">, then you need to protect RRAS server from the Internet side (i.e. only allow access to the services on the public interface that isaccessible from the Internet side). This can be done using RRAS static filters or running Windows Firewall on the public interface (or the interface towards the Internet side). In this scenario following ports need to be opened (bidirectional) on RRAS box to allow VPN traffic to pass through</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For PPTP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=TCP, TCP Port number=1723  &lt;- Used by PPTP control path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=GRE (value 47)  &lt;- Used by PPTP data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For L2TP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=500   &lt;- Used by IKEv1 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=4500 &lt;- Used by IKEv1 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=1701  &lt;- Used by L2TP control/data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=50  &lt;- Used by data path (ESP)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For SSTP:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol=TCP, TCP Port number=443   &lt;- Used by SSTP control and data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">For IKEv2:</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=500   &lt;- Used by IKEv2 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=4500 &lt;- Used by IKEv2 (IPSec control path)</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=UDP, UDP Port Number=1701  &lt;- Used by L2TP control/data path</span></div><div><span style="font: 12.0px Verdana;">•</span><span style="font: 12.0px Verdana;">IP Protocol Type=50 &lt;- Used by data path (ESP)</span></div><div><span style="font: 12.0px Verdana; font-weight: bold;">Note</span><span style="font: 12.0px Verdana;">: Please DO NOT configure RRAS static filters if you are running on the same server RRAS based NAT router functionality. This is because RRAS static filters are stateless and NAT translation requires a stateful edge firewall like ISA firewall.</span></div><div><span style="font: 12.0px Verdana; font-weight: bold;">Do not forget</span><span style="font: 12.0px Verdana;">: If you enable Windows firewall or RRAS static filters on the public interface and only enable VP</span><span style="font: 9.0px Verdana;">N traffic to pass-through, then all the other traffic may be dropped. For example, if the same server is running as a mail server facing internet or a DNS server or a reverse web proxy server, then you need to enable the ports used by those services explicitly. </span></div></en-note>