<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div><span style="color: rgb(145, 145, 145);"># Written by KFH: </span><a style="color: rgb(145, 145, 145);" href="mailto:karshi.hasanov@utoronto.ca">karshi.hasanov@utoronto.ca</a></div><div><span style="color: rgb(145, 145, 145);"># Date: Feb 18, 2009</span></div><div><span style="color: rgb(145, 145, 145);"># Last Modified: August 6, 2017</span></div><div><span style="color: rgb(145, 145, 145);"># Description: Installing the Apache Web Server</span></div><div><br/></div><div><span style="font-weight: bold; font-size: 36px;">Apache 2.4 Server on FreeBSD</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;"> </span><span style="font-size: 24px; font-weight: bold;">Installation</span></div><div>=&gt; <span style="font-weight: bold;">cd </span><span style="color: rgb(148, 17, 0);">/usr/ports/www/apache24 </span></div><div>=&gt;  <span style="font-weight: bold;">sudo make install </span> </div><div>(leave the default options).</div><div><span style="color: rgb(121, 121, 121);">If this is not your first installation, you might need to clean the old one:</span></div><div><span style="color: rgb(121, 121, 121);">=&gt; sudo make clean &amp;&amp; sudo make rmconfig</span></div><div><br/></div><div>Add the line <span style="font-weight: bold;">apache24_enable</span>='<span style="font-weight: bold;">YES</span>' in your<span style="color: rgb(148, 17, 0);"> /etc/rc.conf</span> file</div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">Configuring the main  </span><span style="font-size: 24px; font-weight: bold; color: rgb(148, 17, 0);">httpd.conf </span><span style="font-size: 24px; font-weight: bold;">File</span></div><div><br/></div><div>Open the <span style="color: rgb(148, 17, 0);">/usr/local/etc/apache24/httpd.conf</span> file and check the following settings:</div><div><br/></div><div><span style="font-weight: bold;">ServerAdmin </span><font color="#009051">karshi.hasanov@utoronto.ca</font></div><div><span style="font-weight: bold;">DocumentRoot </span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-style: italic;">“</span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-style: italic;">/opt/hosting/</span><font color="#0433ff">www.karshi.ca</font><span style="color: rgb(148, 17, 0); font-style: italic;">”</span>  </div><div><font color="#929292"># Default location of website </font></div><div><br/></div><div><span style="font-weight: bold;"><font color="#ff40ff">&lt;Directory</font></span> &quot;<font color="#941100">/opt/hosting/</font><font color="#0433ff">www.karshi.ca</font> &quot;<span style="font-weight: bold;"><font color="#ff40ff">&gt;</font></span></div><div><font color="#929292"># These are defaults. </font></div><div><span style="font-weight: bold;">   </span><span style="font-weight: bold; color: rgb(148, 17, 0);"> </span><span style="font-weight: bold; color: rgb(148, 17, 0);">Options</span> Indexes FollowSymLinks</div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(148, 17, 0);">AllowOverride</span> None</div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(148, 17, 0);">Require</span> all granted</div><div><span style="font-weight: bold;"><font color="#ff40ff">&lt;/Directory&gt;</font></span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">Initial</span><span style="font-size: 24px; font-weight: bold;"> Testing</span></div><div><font color="#919191"># Create a test file under the <span style="font-weight: bold;">DocumentRoot </span>folder</font></div><div><font style="color: rgb(145, 145, 145);">#  ( /opt/hosting/www.karshi.ca/index.html)</font></div><div><br/></div><div><font color="#919191"># Restart the server:</font></div><div>.=&gt; <span style="font-weight: bold;">sudo</span><span style="color: rgb(148, 17, 0);"> </span><span style="color: rgb(148, 17, 0); font-weight: bold;">/usr/local/etc/rc.d/</span><span style="font-weight: bold; color: rgb(148, 17, 0);">apache24</span><span style="font-weight: bold; color: rgb(0, 143, 0);"> </span><span style="color: rgb(0, 143, 0); font-weight: bold; font-style: italic;">onestart</span><span style="color: rgb(0, 143, 0); font-weight: bold;"> </span><font color="#919191"><span style="font-weight: bold;"> # </span> Only if you are starting first time !</font></div><div><font color="#919191"># Visit the website  http://www.karshi.ca  or http://IP_Address</font></div><div>  </div><div><font color="#919191"># Watch for the log file</font></div><div>=&gt;<span style="font-weight: bold;"> tail </span>-f <span style="color: rgb(148, 17, 0);">/var/log/&lt;website&gt;</span><span style="color: rgb(148, 17, 0); font-weight: bold;">-access.log</span> </div><div>=&gt; tail -f <span style="color: rgb(148, 17, 0);">/var/log/&lt;website&gt;</span><span style="color: rgb(148, 17, 0); font-weight: bold;">-error.log</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;"> </span><span style="font-size: 24px; font-weight: bold;">Setting Up The Virtual Hosts</span></div><div><br/></div><div># Most of the time, we will need to host multiple web sites, so let us include (enable)</div><div># the Virtual Host File (its in the Supplemental Configuration Session):</div><div><span style="font-weight: bold;">Include</span> </div><div><span style="color: rgb(148, 82, 0);"> etc/apache24/extra/httpd-vhosts.conf</span></div><div># Note: If you use the Virtual Hosts, the Apache will ignore the DocumentRoot Directory.</div><div># Instead, it will default to the first (top) Virtual Host </div><div><br/></div><div> </div><div><span style="font-weight: bold;"><font color="#9437ff">&lt;VirtualHost *:80</font>&gt;</span></div><div>    <font color="#919191"># e-mail for the server admin</font></div><div>    <span style="font-weight: bold;">ServerAdmin</span> <font color="#4f8f00">karshi.hasanov@icloud.com</font></div><div>    <font color="#919191"># Top directory where the files for this virtual hosts are</font></div><div>    <span style="font-weight: bold;">DocumentRoot</span> &quot;<font color="#941100">/opt/hosting/</font><font color="#0433ff">www.karshi.ca</font>&quot;</div><div>    # The server URL for the public. Make sure it's in DNS (local and ISP )</div><div>    <span style="font-weight: bold;">ServerName</span><font color="#0433ff"> www.karshi.ca</font></div><div>    <font color="#919191"># All the errors with the config files, server misconfiguirations etc. are logged here</font></div><div>    <b>ErrorLog</b> &quot;<font color="#941100">/var/log/</font><font color="#0433ff">www.karshi.ca</font><span style="font-weight: bold;">-error.log</span>&quot;</div><div>    <font color="#919191"># This is the access log in common format. </font></div><div>    <span style="font-weight: bold;">CustomLog</span> &quot;<font color="#941100">/var/log/</font><font color="#0433ff">www.karshi.ca</font><span style="font-weight: bold;">-access.log</span>&quot; common</div><div>   <font color="#919191"> # Use this to give access to the servers.</font></div><div>    <span style="font-weight: bold;"><font color="#941100">&lt;Directory</font></span> &quot;<font color="#941100">/opt/hosting/</font><font color="#0433ff">www.karshi.ca</font>&quot;<font color="#941100">&gt;</font></div><div>        <span style="font-weight: bold;">Options</span> All</div><div>        <span style="font-weight: bold;">AllowOverride</span> All</div><div>        # The syntax is case sensitive!</div><div>        <span style="font-weight: bold;">Require</span> all granted</div><div>     <span style="font-weight: bold;"><font color="#941100">&lt;/Directory&gt;</font></span></div><div><span style="font-weight: bold;"><font color="#9437ff">&lt;/VirtualHost&gt;</font></span></div><div><br/></div><div><span style="font-weight: bold; text-decoration: underline;"> </span></div><div><span style="font-weight: bold;"><font style="font-size: 24px;">Setting Up HTTPS (SSL Support)</font></span></div><div><br/></div><div>Edit the  &quot;<span style="font-weight: bold; font-style: italic;">/usr/local/etc/apache24/httpd.conf </span>&quot; and enable the following modules:</div><div><br/></div><div><span style="font-weight: bold;">LoadModule </span><font color="#008f00">socache_shmcb_module</font><font color="#941100"> libexec/apache24/</font><b>mod_socache_shmcb.so</b></div><div><font color="#919191"># This module provides for creation and access to a cache backed by a high-performance </font></div><div><font color="#919191"># cyclic buffer inside a shared memory segment.</font></div><div><br/></div><div><span style="font-weight: bold;">LoadModule<font color="#008f00"> </font></span><font color="#008f00">log_config_module</font><font color="#941100"> libexec/apache24</font>/<b>mod_log_config.so</b></div><div><span style="font-weight: bold;"> </span><font color="#929292"># Allows flexible logging of client requests in a customizable format.</font></div><div><br/></div><div><span style="font-weight: bold;">LoadModule </span>ssl_module libexec/apache24/<b>mod_ssl.so</b></div><div><font color="#919191"># This module provides SSL v3 and TLS v1.x support for the Apache HTTP Server.</font></div><div> </div><div><font color="#919191"># Uncomment the line:</font><br/></div><div><span style="font-weight: bold;">Include</span> <font color="#941100">etc/apache24/extra/</font><span style="font-weight: bold;">httpd-ssl.conf</span></div><div><br/></div><div>#——————————— hhtpd-ssl.conf ---------------------------</div><div>=&gt;<b> sudo</b> vi  <span style="font-style: italic;"><font color="#941100">/usr/local/etc/apache24/extra/</font></span><span style="font-weight: bold; font-style: italic;">httpd-ssl.conf </span></div><div><br/></div><div><span style="font-weight: bold;"><font color="#9437ff">&lt;VirtualHost _default_:443&gt;</font></span></div><div><span style="font-weight: bold;">DocumentRoot </span>&quot;<font color="#941100">/opt/hosting/</font><font color="#0096ff">www.</font><font style="color: rgb(0, 150, 255);">karshi.ca</font>”</div><div><span style="font-weight: bold;">ServerName  </span>www.karshi.ca:443</div><div><span style="font-weight: bold;">ServerAdmin </span>karshi.hasanov@gmail.com</div><div><span style="font-weight: bold;">ErrorLog  </span>&quot;<font color="#941100">/var/log/</font><font color="#531b93">ssl_www.karhsi.ca-error.log</font>&quot;<br/></div><div><span style="font-weight: bold;">TransferLog </span>&quot;<font color="#941100">/var/log/</font><font color="#531b93">ssl_www.karshi.ca-access.log</font>&quot;<br/></div><div><br/></div><div><font color="#929292">#   Enable/Disable SSL for this virtual host.</font><br/></div><div><span style="font-weight: bold;"> SSLEngine </span>on</div><div><br/></div><div><span style="font-weight: bold;">  SSLCertificateFile </span>&quot;<font color="#941100">/etc/kfh-certs/ca/certs/freebsd-srv/</font><font color="#009193">freebsd.crt</font></div><div>  <span style="font-weight: bold;">SSLCertificateKeyFile </span>&quot;<font color="#941100">/etc/kfh-certs/ca/certs/freebsd-srv/</font>f<font color="#009193">reebsd_key.pem</font>&quot;</div><div><br/></div><div><font color="#919191"># Don’t forget to modify this directory and create the “/opt/hosting/scripts” folder:</font></div><div><font color="#919191"># sudo mkdir /opt/hosting/scripts &amp;&amp; sudo chown www:www /opt/hosting/scripts</font></div><div><span style="font-weight: bold;">    &lt;Directory </span>&quot;<font color="#941100">/opt/hosting/scripts/cgi-bin</font>” &gt;</div><div>    <span>    <span>    </span></span>SSLOptions +StdEnvVars</div><div><span style="font-weight: bold;">    &lt;/Directory&gt;</span></div><div><br/></div><div><span style="font-weight: bold;">CustomLog </span>“ <font color="#941100">/var/log/</font>ssl_www.karshi.ca<span style="font-weight: bold;">-request.log</span>”  \</div><div>                       &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;</div><div><br/></div><div><span style="font-weight: bold;"><font color="#9437ff">&lt;/VirtualHost&gt;</font></span></div><div><br/></div><div># Finally, restart the server ( reload won’t load the modules !)</div><div>=&gt;<b> sudo service apache24 restart</b></div><div><br/></div><div><br/></div></en-note>
