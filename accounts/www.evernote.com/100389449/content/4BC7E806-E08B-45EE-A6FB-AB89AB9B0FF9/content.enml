<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div><span style="color: rgb(146, 146, 146);"># Written by KFH: </span><a style="color: rgb(255, 64, 255);" href="mailto:karshi.hasanov@utoronto.ca">karshi.hasanov@utoronto.ca</a></div><div><span style="color: rgb(146, 146, 146);"># Date: October 5, 2015</span></div><div><span style="color: rgb(146, 146, 146);"># Last Modified: August 8, 2017</span></div><div><span style="color: rgb(146, 146, 146);"># Description: Installing and setting up the DNS Server on FreeBSD 11.1</span></div><div><span style="font-weight: bold; font-size: 24px;">Installation</span></div><div><br/></div><div><span style="color: rgb(148, 82, 0);">Note:</span></div><div><span style="color: rgb(148, 82, 0);"> * Since FreeBSD 10.x no more the “base” BIND in the FreeBSD</span></div><div><span style="color: rgb(148, 82, 0);">So, you won’t find &quot;/etc/namedb” and &quot;/usr/sbin/named”</span></div><div><span style="color: rgb(148, 82, 0);">and you don’t need to make a link to those files.</span></div><div><br/></div><div>=&gt; <span style="font-weight: bold;">cd</span> <span style="color: rgb(148, 17, 0);">/usr/ports/dns/bind99 </span></div><div>=   <span style="font-weight: bold;">sudo make install clean</span></div><div><br/></div><div>Add the line <span style="font-weight: bold;">named_enable=&quot;YES&quot;</span> to<span style="font-style: italic;"> &quot;/etc/rc.conf&quot;</span></div><div>Make sure the following files are setup &quot;<span style="color: rgb(148, 33, 147);">/etc/hosts</span>&quot;  and &quot;<span style="color: rgb(255, 64, 255);">/etc/resolv.conf</span>&quot;</div><div><span style="color: rgb(148, 33, 147);">⁃-------------------- /etc/hosts -------------------</span></div><div><span style="color: rgb(148, 33, 147);">127.0.0.1    localhost</span></div><div><span style="color: rgb(148, 33, 147);">192.168.100.150 freebsd.karshi.ca  vmfreebsd</span></div><div><span style="color: rgb(148, 33, 147);">-------------------- End ---------------------------</span></div><div><br/></div><div><span style="font-style: italic;">Note: You can only put maximum 3 nameservers in the &quot;resolve.conf&quot; file.</span></div><div><span style="font-style: italic;">We put &quot;192.168.100.150&quot; and &quot;192.168.100.1&quot; in a case if our DNS Server will stop working.</span></div><div><span style="font-style: italic;">Otherwise, we don't need them.</span></div><div><span style="color: rgb(255, 64, 255);">--------------------/etc/resolv.conf---------------</span></div><div><span style="color: rgb(255, 64, 255);">search </span><a style="color: rgb(255, 64, 255);" href="http://karshi.ca">karshi.ca</a></div><div><span style="color: rgb(255, 64, 255);">nameserver 127.0.0.1</span></div><div><span style="color: rgb(255, 64, 255);">nameserver 192.168.100.150</span></div><div><span style="color: rgb(255, 64, 255);">nameserver 192.168.100.1</span></div><div><span style="color: rgb(255, 64, 255);">-------------------- End ---------------------------</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">Cache-Only DNS Server</span></div><div>In the file &quot;/usr/local/etc/namedb/<span style="font-weight: bold;">named.conf</span>&quot; file:</div><div>If you want the DNS Server to listen and serve outside, comment this:</div><div> // <span style="font-weight: bold;"> listen-on</span>      { 127.0.0.1; };</div><div><br/></div><div>If the DNS can't resolve the request, it will appeal an upper level DNS Server</div><div> --&gt; <span style="font-weight: bold;"> forwarders</span> {</div><div>                        // 10.10.10.10;     // SSG-5 Gateway</div><div>                        192.168.100.1;     // Bell Modem</div><div>                        }</div><div><br/></div><div><span style="font-weight: bold; text-decoration: underline;">Test the Installation:</span></div><div><br/></div><div>First, make sure that the DNS Server is running:</div><div>    =&gt;<span style="font-weight: bold;"> sudo service named</span><span style="color: rgb(4, 51, 255);"> </span><span style="color: rgb(4, 51, 255); font-style: italic;">status</span></div><div># If not</div><div>    =&gt; <span style="font-weight: bold;"> sudo service named</span> <span style="font-style: italic; color: rgb(0, 144, 81);">start</span></div><div>To test<span style="font-weight: bold; font-style: italic;"> DNS</span><span style="font-style: italic;">  </span><span style="font-style: italic;">name resolution</span><span style="font-style: italic;">:</span> </div><div>    =&gt;<span style="font-weight: bold;"> dig</span><span style="color: rgb(148, 17, 0);"> @localhost</span>  <span style="color: rgb(148, 55, 255);">www.google.com</span> </div><div>    </div><div><br/></div><div><span style="color: rgb(146, 146, 146);">First time when you issue the above command, see the &quot;Query time&quot; and compare it with</span></div><div><span style="color: rgb(146, 146, 146);">the second time when you request the name resolution.</span></div><div><span style="color: rgb(146, 146, 146);">Example: For Google, </span></div><div><span style="color: rgb(146, 146, 146);">;; Query time: 9 msec ( first time )</span></div><div><span style="color: rgb(146, 146, 146);">;; Query time: 0 msec ( second time )</span></div><div><br/></div><div><span style="font-weight: bold; font-size: 36px;">Master DNS Server</span></div><div><br/></div><div><span style="font-size: 24px; font-weight: bold;">Part 1: The RNDC Key and Configuration File</span></div><div><span style="font-size: 18px; font-weight: bold;">#</span><span style="font-size: 18px;"> First you need to the create rndc key file</span></div><div><span style="font-size: 18px;">=&gt;</span><span style="font-size: 18px; font-weight: bold;"> sudo</span><span style="font-size: 18px;"> </span><span style="font-size: 18px; color: rgb(0, 143, 0);">rndc-confgen</span></div><div><span style="font-size: 18px;">1. Copy the output to the file </span><span style="font-size: 18px; color: rgb(148, 17, 0);">/usr/local/etc/namedb/</span><span style="font-size: 18px; font-weight: bold;">rndc.conf</span></div><div>2. Copy the “key” part to the file <span style="color: rgb(148, 17, 0);">/usr/local/etc/namedb/</span><span style="font-weight: bold;">rndc.key</span></div><div><span style="color: rgb(121, 121, 121);"># An example of the key part:</span></div><div><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">key &quot;rndc-key&quot; {</span></div><div><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">algorithm hmac-md5;</span></div><div><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">secret &quot;iL3/n6BPIFhg9MnV/l3TBA==&quot;;</span></div><div><span style="color: rgb(121, 121, 121);">    </span><span style="color: rgb(121, 121, 121);">};</span></div><div><div>3. Insert the line<font color="#9437ff"> include</font> <font color="#941100">“/usr/local/etc/named/rndc.key” </font> before the  “<font color="#929000">options</font>”</div><div>    in the <b>/usr/local/namedb/<font color="#005493">named.conf</font></b><font color="#005493"> </font>file.</div><div><br/></div><ol start="3"/></div><div><span style="font-size: 24px; font-weight: bold;">Part 2</span><span style="font-size: 24px;"> :</span><span style="font-size: 24px; font-weight: bold;"> Editing the</span> <span style="color: rgb(148, 17, 0);">/usr/local/etc/namedb/</span><span style="color: rgb(0, 84, 147);">named.conf</span><span style="font-weight: bold;"> </span><span style="font-weight: bold; font-size: 24px;">file</span></div><div>--------------------------------------------------------------------</div><div><span style="color: rgb(145, 145, 145);">// KFH: Forward Zone</span></div><div><span style="font-weight: bold;">zone </span>“<span style="color: rgb(4, 51, 255);">karshi.ca</span>&quot; {</div><div>       <span style="font-weight: bold;"> type </span><span style="color: rgb(0, 144, 81);">master</span> ;</div><div>       <span style="font-weight: bold; font-style: italic;"> file</span> &quot;<span style="color: rgb(148, 17, 0);">/usr/local/etc/namedb/master/</span><span style="color: rgb(4, 51, 255);">forward_karshi.ca</span> &quot;;</div><div>};</div><div><br/></div><div><span style="color: rgb(145, 145, 145);">// KFH: Reverse Zone</span></div><div><span style="color: rgb(145, 145, 145);">// The first three octets are need to be reversed. </span></div><div><span style="color: rgb(145, 145, 145);">// Examples: 192.168.2.35 --&gt; 2.168.192.in-addr.arpa  </span></div><div><span style="color: rgb(145, 145, 145);">//              10.0.0.15 --&gt; 0.0.10.in-addr.arpa</span></div><div><span style="color: rgb(145, 145, 145);">//              10.2.6.12 --&gt; 6.2.10.in-addr.arpa</span>                       </div><div><span style="font-weight: bold;">zone</span> &quot;<span style="color: rgb(255, 38, 0);">100.168.192.in-addr.arpa</span>&quot; {</div><div>        <span style="font-weight: bold;">type</span><span style="font-weight: bold; color: rgb(0, 143, 0);"> </span><span style="color: rgb(0, 143, 0);">master </span>;</div><div>       <span style="font-weight: bold; font-style: italic;"> file</span> &quot;<span style="color: rgb(148, 17, 0);">/usr/local/etc/namedb/master/</span><span style="color: rgb(255, 38, 0);">reverse_karshi.ca</span>&quot;;</div><div>};</div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">Part 3: Creating the Forward File</span><span style="font-weight: bold;"> :</span> <span style="color: rgb(4, 51, 255);">forward_karshi.ca </span></div><div>-------------------------------------------------------------------------------------------------------------------------------</div><div>; TTL -  Time to live in seconds : The time DNS servers will cache info from this zone.</div><div><span style="color: rgb(146, 146, 146);">; SOA - Start Of Authority zone: Followed by the Name Server (NS) and admin email (replace “@“ with “”.” (dot))</span></div><div><span style="color: rgb(146, 146, 146);">;            Don’t forget to put the “.” (dot) after NS and Email. (kind of ugly format)</span></div><div><span style="color: rgb(146, 146, 146);">;            Example: SOA   ns1.karshi.ca. admin.karshi.ca. ( i.e.  admin@karshi.ca.)  &lt;— always “.” (dot) at the end !</span></div><div><span style="color: rgb(146, 146, 146);">; IN - Internet</span></div><div><span style="color: rgb(146, 146, 146);">; NS - Name Server</span></div><div><span style="color: rgb(146, 146, 146);">;  A - Called “A” record. Its just a host name. You give the hostname without domain and the DNS server will</span></div><div><span style="color: rgb(146, 146, 146);">;        attach the domain name . The domain name must be managed by the DNS zone.</span></div><div><span style="color: rgb(146, 146, 146);">; CNAME - The Canonical Name for an Alias. “www” —&gt; “freebsd.karshi.ca”</span></div><div><span style="color: rgb(146, 146, 146);">;                  an other words “www.karshi.ca” = “freebsd.karshi.ca”</span></div><div><span style="color: rgb(146, 146, 146);">;                   Sometime you see the “@“ sign which means the current host name (or IP)</span></div><div><span style="color: rgb(146, 146, 146);">;                  I could have set “www” —&gt; “@“ since “freebsd.karshi.ca” is the machine I am running the DNS server.</span></div><div><span style="color: rgb(146, 146, 146);">; MX - Mail Exchange Server. The DNS server wants to know who is taking care of the incoming emails for this domain.</span></div><div><span style="color: rgb(146, 146, 146);">; The main purpose of the DNS forward file is to resolve the name resolution: You give the name of  a website or server</span></div><div><span style="color: rgb(146, 146, 146);">; it will return the corresponding  IP address. For example, <a href="http://www.google.com">www.google.com</a> -&gt; IP = 172.217.2.164. However, there are</span></div><div><font color="#929292">; many Google servers around and you only will get the closest one to you. The “nslookup” command will tell you which one.</font></div><div><font color="#929292">; The DNS forward command also can tell you which Mail Exchange server (MX) will be taking care of the emails coming</font></div><div><font color="#929292">; to the domian. You need to setup the MX record to do so.</font></div><div>    </div><div>&lt;————————————————  <span style="color: rgb(4, 51, 255);">forward_karshi.ca</span><span style="color: rgb(4, 51, 255); font-weight: bold;"> </span><span style="font-weight: bold;">file  </span>—————————————&gt; </div><div><span style="font-weight: bold;">$TTL</span> 3600      <span style="font-weight: bold;"> ; </span><span style="color: rgb(121, 121, 121);">1 hour default TTL</span></div><div><span style="color: rgb(4, 51, 255);">karshi.ca.   </span>  <span style="font-weight: bold;">   IN </span>    <span style="font-weight: bold;"> SOA </span>     <span style="color: rgb(4, 51, 255);">freebsd.karshi.ca. </span><span style="color: rgb(255, 38, 0);">admin.karshi.ca </span><span style="font-weight: bold;">(</span></div><div>                               <span style="font-weight: bold;"> 20151005     ;</span>     <span style="color: rgb(146, 146, 146);">Serial number: Usually year/month/day</span></div><div>                                <span style="font-weight: bold;">10800           ;</span><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">Refresh: If there any slave DNS, it must wait this amount of seconds for an update</span></div><div>                               <span style="font-weight: bold;"> 3600             ;</span><span style="font-weight: bold; color: rgb(146, 146, 146);">    </span><span style="font-weight: bold;"> </span><span style="color: rgb(146, 146, 146);">Retry: If for some reason a slave DNS get disconnected, it must try after these seconds</span></div><div>                               <span style="font-weight: bold;"> 604800         ;</span><span style="font-weight: bold;">    </span> <span style="color: rgb(146, 146, 146);">Expire: If a slave DNS won't contact after this amount of seconds, the DNS Server </span></div><div>                                                    <span style="font-weight: bold;"> ;</span>     <span style="color: rgb(146, 146, 146);">will stop answering DNS queries</span></div><div>                               <span style="font-weight: bold;"> 86400           ;    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">Negative Response TTL: When the DNS can't resolve a name, it will keep the answer </span></div><div>                                                    <span style="font-weight: bold;"> ;</span><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">in a cache for so long time.</span></div><div>                              <span style="font-weight: bold;">  )</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);">; DNS Servers</span></div><div><span style="color: rgb(4, 51, 255);">karshi.ca. </span>             <span style="font-weight: bold;">  IN </span>   <span style="font-weight: bold;">  </span><span style="font-weight: bold; color: rgb(122, 129, 255);">NS</span><span style="font-weight: bold;"> </span>     <span style="color: rgb(4, 51, 255);">freebsd.karshi.ca.</span></div><div><br/></div><div><br/></div><div><span style="color: rgb(145, 145, 145);">; Machine Names</span></div><div><span style="font-weight: bold;">localhost</span><span style="font-weight: bold;"> </span>    <span style="font-weight: bold;">   </span><span style="font-weight: bold;">IN</span>     <span style="color: rgb(0, 145, 147);"> A</span>      <span style="color: rgb(0, 145, 147);"> 127.0.0.1</span></div><div><span style="font-weight: bold;">imac  </span>           <span style="font-weight: bold;">  IN</span>      <span style="color: rgb(0, 145, 147);">A        192.168.100.100</span></div><div><span style="font-weight: bold;">freebsd</span>          <span style="font-weight: bold;"> </span><span style="font-weight: bold;">IN</span>      <span style="color: rgb(0, 145, 147);">A       192.168.100.150</span></div><div><span style="font-weight: bold;">linux </span>              <span style="font-weight: bold;"> </span><span style="font-weight: bold;">IN  </span>    <span style="color: rgb(0, 145, 147);">A       192.168.100.160</span></div><div><span style="font-weight: bold;">windows</span>        <span style="font-weight: bold;"> IN</span>      <span style="color: rgb(0, 145, 147);">A       192.168.100.170</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);">; Aliases</span></div><div><span style="font-weight: bold;">ns1 </span>              <span style="font-weight: bold;">  IN </span>     <span style="color: rgb(148, 55, 255);">CNAME</span>  <span style="color: rgb(148, 55, 255);"> freebsd.karshi.ca.</span></div><div><span style="font-weight: bold;">www</span>            <span style="font-weight: bold;">  IN</span>       <span style="color: rgb(148, 55, 255);">CNAME  @  </span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);">; Mail Exchange Server</span></div><div><span style="color: rgb(146, 146, 146);">;                    IN MX 10   mail.karshi.ca.</span></div><div><br/></div><div><br/></div><div> </div><div>&lt;———————————————— <font color="#ff2600"> reverse_karshi.ca</font><span style="color: rgb(4, 51, 255); font-weight: bold;"> </span><span style="font-weight: bold;">file  </span>—————————————&gt; <br/></div><div><span style="font-weight: bold;">$TTL</span> 3600      <span style="font-weight: bold;"> ; </span><span style="color: rgb(121, 121, 121);">1 hour default TTL</span></div><div><font style="color: rgb(255, 38, 0);">100.168.192.in-addr.arpa.   </font><span style="color: rgb(4, 51, 255);"> </span>  <span style="font-weight: bold;">   IN </span>    <span style="font-weight: bold;"> SOA </span>     <span style="color: rgb(4, 51, 255);">freebsd.karshi.ca. </span><span style="color: rgb(255, 38, 0);">admin.karshi.ca </span><span style="font-weight: bold;">(</span></div><div>                               <span style="font-weight: bold;"> 20151005     ;</span>     <span style="color: rgb(146, 146, 146);">Serial number: Usually year/month/day</span></div><div>                                <span style="font-weight: bold;">10800           ;</span><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">Refresh: If there any slave DNS, it must wait this amount of seconds for an update</span></div><div>                               <span style="font-weight: bold;"> 3600             ;</span><span style="font-weight: bold; color: rgb(146, 146, 146);">    </span><span style="font-weight: bold;"> </span><span style="color: rgb(146, 146, 146);">Retry: If for some reason a slave DNS get disconnected, it must try after these seconds</span></div><div>                               <span style="font-weight: bold;"> 604800         ;</span><span style="font-weight: bold;">    </span> <span style="color: rgb(146, 146, 146);">Expire: If a slave DNS won't contact after this amount of seconds, the DNS Server </span></div><div>                                                    <span style="font-weight: bold;"> ;</span>     <span style="color: rgb(146, 146, 146);">will stop answering DNS queries</span></div><div>                               <span style="font-weight: bold;"> 86400           ;    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">Negative Response TTL: When the DNS can't resolve a name, it will keep the answer </span></div><div>                                                    <span style="font-weight: bold;"> ;</span><span style="font-weight: bold;">    </span><span style="font-weight: bold; color: rgb(146, 146, 146);"> </span><span style="color: rgb(146, 146, 146);">in a cache for so long time.</span></div><div>                              <span style="font-weight: bold;">  )</span></div><div><br/></div><div><span style="color: rgb(146, 146, 146);">; DNS Servers</span></div><div><span style="color: rgb(255, 38, 0);">100.168.192.in-addr.arpa. </span>             <span style="font-weight: bold;">  IN </span>   <span style="font-weight: bold;">  </span><span style="font-weight: bold; color: rgb(122, 129, 255);">NS</span><span style="font-weight: bold;"> </span>     <span style="color: rgb(4, 51, 255);">freebsd.karshi.ca.</span></div><div><br/></div><div><br/></div><div><span style="color: rgb(145, 145, 145);">; Machine Names</span></div><div><font color="#919191">; Don’t forget “.” after the hostname !</font></div><div><span style="font-weight: bold;">100 </span>           <span style="font-weight: bold;">  IN</span>      <font color="#941100">PTR        imac.karshi.ca.</font></div><div><b>150</b>             <span style="font-weight: bold;"> </span><span style="font-weight: bold;">IN</span>      <font color="#941100">PTR       freebsd.karshi.ca.</font></div><div><span style="font-weight: bold;">160 </span>             <span style="font-weight: bold;">IN  </span>  <font color="#941100">  PTR      linux.karshi.ca.</font></div><div><b>170</b>        <span style="font-weight: bold;">      IN</span>      <font color="#941100">PTR      windows.karshi.ca.</font></div><div><br/></div><div><br/></div><div><br/></div></en-note>
