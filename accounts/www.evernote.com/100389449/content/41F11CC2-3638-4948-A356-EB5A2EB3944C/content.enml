<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div><span style="font-weight: bold; font-size: 24px;">Auto Login using the Public-key</span></div><div><font color="#797979"># Written by KFH: <a style="color: rgb(121, 121, 121);" href="mailto:karshi.hasanov@utoronto.ca">karshi.hasanov@utoronto.ca</a></font></div><div><font color="#797979"># Date: May 17, 2002</font></div><div><font color="#797979"># Last Modified: July 20, 2017</font></div><div><font color="#797979"># Description: Auto Login to a SSH Server using the public key.</font></div><div><font color="#797979"><br/></font></div><div><span style="font-weight: bold; font-style: italic;">Theory:</span></div><div> The basic idea is that there are two realted numbers, called <span style="font-weight: bold; font-style: italic;">keys</span>, such  that</div><div>a message encrypted by one can be decrypted by the other, and vice verse.</div><div>One of these keys is called the <span style="font-weight: bold;">public key</span> and the other the <span style="font-weight: bold;">private key</span>. The <span style="font-weight: bold;">public key</span> is known to everyone while the <span style="font-weight: bold;">private key</span> is known only to you.</div><div><span style="font-style: italic; text-decoration: underline;">The authentication works essentially like this:</span><span style="text-decoration: underline;"> </span>The server knows your <span style="font-weight: bold;">public key</span>, you know your <span style="font-weight: bold;">private key</span>. </div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">Client Side :</span></div><div>Generating the <span style="font-weight: bold;">public</span> - <span style="font-weight: bold;">private key</span> pair:</div><div>=&gt;<span style="font-weight: bold;"> ssh-keygen</span> -t<span style="color: rgb(148, 17, 0);"> rsa</span> -b 2048      # &quot;rsa&quot; for SSH v2,  &quot;t&quot; - type, &quot;b&quot; - bits</div><div>( In my iMAC this command created two files “id_rsa” and “<span style="color: rgb(79, 143, 0);">id_rsa.pub</span>” (public key))</div><div>Copy the public key &quot;<span style="color: rgb(79, 143, 0);">id_rsa.pub</span>” to the SSH Server </div><div><br/></div><div><span style="font-weight: bold; font-size: 24px;">Server side</span> ( where you want to auto login):</div><div><br/></div><div>Edit the “<span style="color: rgb(148, 17, 0);">/etc/sshd/sshd_config</span>” file and make sure that</div><div><span style="font-weight: bold;">   PubkeyAuthentication </span><span style="font-style: italic;">yes</span></div><div><span style="color: rgb(121, 121, 121);"># If you made any change to the config file, restart the server</span></div><div><br/></div><div>Get the public key from the client side and put it in the “~/.ssh/authorized_keys” file.</div><div>Suppose you have the public RSA key called “id_rsa.pub” , then:</div><div>=&gt;<span style="font-weight: bold;"> cat </span><span style="color: rgb(0, 143, 0);">id_rsa.pub</span> &gt;&gt; <span style="color: rgb(148, 17, 0);">~/.ssh/</span><span style="color: rgb(0, 150, 255);">authorized_keys</span></div><div><br/></div><div><b><font style="font-size: 24px;">Troubleshooting:</font></b></div><div>If anything go wrong, check the SSH Server log file</div><div>=&gt;<span style="font-weight: bold;"> tail -f</span> <span style="color: rgb(148, 17, 0);">/var/log/auth.log</span>  <span style="color: rgb(121, 121, 121);"># The location of the SSH Server might be different in  your system.</span></div><div><br/></div><div><span style="font-weight: bold; font-size: 24px; text-decoration: underline;">SSH Tips</span></div><div><br/></div><div><span style="font-weight: bold; text-decoration: underline;">Running Commands on as Remote Server</span></div><div><br/></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>    <span style="font-weight: bold;">df -h</span></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">'df -h'</span></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">&quot;df -h&quot; </span></div><div><br/></div><div># If you want to save the results in a local file, use &quot;&gt;&quot;</div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">'df -h'  &gt; </span>remote_df.txt</div><div><br/></div><div># You can run multiple commands or use the pipes:</div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span> <span style="font-weight: bold;">'cat </span><span style="font-style: italic;">/etc/rc.conf '  </span><span style="font-weight: bold; font-style: italic;"> </span><span style="font-weight: bold;">|</span>  <span style="font-weight: bold;">grep</span> <span style="font-style: italic;">inetd_enable</span> </div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">How To Dump the contents of a File Remotely</span></div><div><br/></div><div>Example: We want to transfer a file, called &quot;<span style="font-weight: bold;">id_rsa</span>&quot;, to a Remote SSH Server:</div><div>Client PC : The location of the file is &quot;<span style="font-style: italic;">/home/khasanov/.ssh</span>&quot;</div><div>Remote Server:  <a href="http://www.karshi.ca">www.karshi.ca</a> </div><div>We want to add the contents of the file at the end of the &quot;authorized_keys&quot; which is</div><div>                          located in &quot;<span style="font-style: italic;">/home/khasanov/.ssh/</span><span style="font-weight: bold;">authorized_keys</span>&quot;</div><div><br/></div><div>Method 1:=&gt; ssh  <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt; id_rsa.pub &quot;|&quot; dd  of=<span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div><br/></div><div>Method 2:=&gt; ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt;  id_rsa.pub &quot;&gt;&quot; <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 3:=&gt; ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt;  id_rsa.pub - &quot;&gt;&quot;  <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 4:=&gt; cat id_rsa.pub | ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &quot;&gt;&quot;  <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 5:=&gt; dd if=id_rsa.pub | ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> dd  of=<span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 6:=&gt; ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt; id_rsa.pub &quot;|&quot; dd of=<span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div><br/></div></en-note>
