<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note><div>Installing Ubuntu under FreeBSD</div><div><br /></div><div><font color="#929292"># Packages Require: </font><b><font color="#919191">vm-bhyve</font></b><font color="#929292"> and</font><font color="#919191"> <b>grub2-bhyve</b></font></div><div><font color="#929292"># =&gt; sudo pkg install vm-bhyve grub2-bhyve</font></div><div><font color="#929292"># or</font></div><div>=&gt;<b> cd</b> <font color="#941100">/usr/ports/sysutils/vm-bhyve/</font></div><div>=&gt; <font color="#ff2f92">sudo</font> <b>make install clean</b></div><div>=&gt; <b>cd</b> /usr/ports/sysutils/grub2-bhyve/</div><div>=&gt;<font color="#ff2f92"> sudo</font> <b>make install clean</b></div><div><br /></div><div><font color="#929292"># Load kernel modules</font></div><div>=&gt; <font color="#ff2f92">sudo</font><b> kldload</b><font color="#9437ff"> if_bridge if_tap nmdm vmm</font></div><div><br /></div><div><font color="#929292"># Make loading of kernel modules persistent</font></div><div><font color="#929292"># Edit the </font><font color="#797979">/boot/loader.conf</font><font color="#929292"> and add the following line:</font></div><div>   <font color="#929000"> if_bridge_load</font>=“<font color="#009051">YES</font>"</div><div>   <font color="#929000"> if_tap_load</font>=“<font color="#009051">YES</font>"</div><div><span>    </span><font color="#929000">nmdm_load</font>=“<font color="#009051">YES</font>"</div><div>   <font color="#929000"> vmm_load</font>=“<font color="#009051">YES</font>"</div><div><br /></div><div><font color="#929292"># Edit the /etc/rc.conf and add the lines</font></div><div><span>    </span><font color="#929000">vm_enable</font>=“<font color="#008f00">YES</font>"</div><div><span>    </span><font color="#929000">vm_enable</font>=“<font color="#008f00">YES</font>"</div><div><span>    </span><font color="#929000">vm_list</font>=“"</div><div> <span>    </span><font color="#929000">vm_delay</font>=“<font color="#008f00">5</font>"</div><div><br /></div><div><font color="#929292"># Note. The above step can be done using the “sysrc” command:</font></div><div><font color="#929292">#  sysrc vm_enable=“YES”</font> </div><div><br /></div><div><font color="#929292"># Create a zfs file system for VMs</font></div><div>=&gt; <font color="#ff2f92">sudo</font><b> zfs create -o mountpoint</b>=<font color="#941100">/vms</font>  <font color="#ff2f92">zroot</font>/<font color="#941100">vms</font></div><div><font color="#929292"># Note: My zpool name is “zroot”. Replace it with yours</font></div><div><font color="#929292"><br /></font></div><div><font color="#929292"># Initiate the VM</font></div><div>=&gt;<font color="#ff2f92"> sudo</font><b> vm</b><font color="#009193"> init</font></div><div><br /></div><div><font color="#929292"># Copy VM Template examples to the /vms/.templates/</font></div><div>=&gt;<font color="#ff2f92"> sudo</font><font color="#941100"> /usr/local/share/examples/vm-bhyve/*</font> <font color="#929000">/vms/.templates/</font></div><div><font color="#929292"># You will find different template examples for different OS’s here</font></div><div><br /></div><div><font color="#929292"># Create bridge device, replace em1 with your network controller</font></div><div>=&gt;<font color="#ff2f92"> sudo</font> <b>vm</b> <font color="#0433ff">switch</font> <b>create</b><font color="#009051"> public</font></div><div>=&gt; <b>vm</b> <font color="#0433ff">switch</font><b> add</b> <font color="#008f00">public</font> <b>em1</b></div><div><font color="#929292"># I have the “em0” facing to the “internet” and “em1” to local.</font></div><div><font color="#929292"># My router setup as a router, so there is the forwarding going on</font></div><div><font color="#929292"># between the “em0” and “em1” interfaces.</font></div><div><br /></div><div><font color="#929292"># Grab Ubuntu 16.04 ISO</font></div><div>=&gt;<font color="#ff2f92"> sudo</font> <b>vm iso</b>  <a href="http://mirror.csclub.uwaterloo.ca/ubuntu-releases/16.04.4/ubuntu-16.04.4-server-amd64.iso">http://mirror.csclub.uwaterloo.ca/ubuntu-releases/16.04.4/ubuntu-16.04.4-server-amd64.iso</a></div><div><font color="#929292"><br /></font></div><div><font color="#929292"># Note: The above command will save the ISO image under “/vms/.iso”</font></div><div><font color="#929292"># so next time you want to create another Ubuntu VM you don’t need to</font></div><div><font color="#929292"># download again.</font></div><div><font color="#929292"><br /></font></div><div><font color="#929292"><br /></font></div><div><span style="color: rgb(146, 146, 146);"># Create VM and start installation from the ISO. After installation is done</span></div><div><span style="color: rgb(146, 146, 146);"># and OpenSSH is configured to start on boot, shut down the machine to gain back</span></div><div><span style="color: rgb(146, 146, 146);"># control over your FreeBSD session</span></div><div><font color="#929292"><br /></font></div><div><font color="#929292">#  “-t ubuntu” means use the Ubuntu template defined in "/vms/.templates/“ folder</font></div><div><font color="#929292"># “-s 100G” create 100G size for the our new VM and we want to call it “ubuntu-gts" </font></div><div>=&gt;<font color="#ff2f92"> sudo</font> <b>vm create</b> <font color="#941100">-t ubuntu</font> -<font color="#005493">s 100G</font><font color="#0433ff"> ubuntu-gts</font></div><div><br /></div><div><font color="#929292"># Installing the new VM using our downloaded ISO image</font></div><div>=&gt; <font color="#ff2f92">sudo</font> <b>vm install</b><font color="#0433ff"> ubuntu-gts</font> <b>ubuntu-16.04.4-server-amd64.iso</b></div><div><br style="color: rgb(146, 146, 146);" /></div><div><font color="#929292"># To start our newly created VM at boot , we need to add to the “vm_list”</font></div><div><font color="#929292"># defined in “/etc/rc.conf"</font></div><div><span style="color: rgb(146, 146, 146);">    </span><font color="#929000">vm_list</font><font color="#929292">=“</font><font color="#008f00">ubuntu-gts</font><font color="#929292">"</font></div><div><font color="#929292"># You can add mutiple VM in the list separted by a space</font></div><div><br /></div><div><br /></div><div><span style="color: rgb(146, 146, 146);"># Optional: If you want to do more configuration or change some of the</span></div><div><span style="color: rgb(146, 146, 146);"># settings, it time to do so.</span></div><div>=&gt; <font color="#ff2f92">sudo</font><b> vm configure</b><font color="#0433ff"> ubuntu-gts</font></div><div><br style="color: rgb(146, 146, 146);" /></div><div><span style="color: rgb(146, 146, 146);"># Start VM</span></div><div>=&gt; <font color="#ff2f92">sudo</font> <b>vm start</b><font color="#0433ff"> ubuntu-gts</font></div><div><br style="color: rgb(146, 146, 146);" /></div><div><span style="color: rgb(146, 146, 146);"># Open console on VM</span></div><div>=&gt;<font color="#ff2f92"> sudo</font> <b>vm console</b><font color="#0433ff"> ubuntu-gts</font></div><div><font color="#929292"><br /></font></div><div><font color="#929292"><br /></font></div><div><font color="#929292"><br /></font></div><div><font color="#929292"><br /></font></div></en-note>