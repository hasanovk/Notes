<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">
<en-note><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;"><div style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;background-color:rgb(44, 44, 41);font-family:Tahoma;font-size:11px;color:rgb(44, 44, 41);"><div style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;text-align:left;"><div style="outline:0px none currentcolor;vertical-align:baseline;background:rgb(255, 255, 255) url(&amp;quot;images/wider/content_middle.png&amp;quot;) repeat-y scroll 0% 0%;"><div style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;"><div style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;overflow:hidden;">
<div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;padding:0px;background:transparent url(&amp;quot;images/date_comm_box.png&amp;quot;) no-repeat scroll 0% 0%;margin:0px 0px 0px -72px;height:100px;width:57px;position:absolute;text-align:center;z-index:2;"><span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;margin-left:-1px;padding-top:10px;display:block;font-weight:700;text-transform:uppercase;letter-spacing:-1px;"><span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;font-size:24px;display:block;">16</span>Apr/10</span><span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;padding-top:14px;color:rgb(255, 255, 255);display:block;font-weight:700;"><a href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/#comments" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;color:rgb(255, 255, 255);text-decoration:none;margin:0px 9px 0px 8px;padding:6px 0px 5px;display:block;">1</a></span></div>
<h2 style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:10px 0px 3px;padding:0px;background-color:rgb(255, 255, 255);border-bottom:1px solid rgb(220, 220, 219);letter-spacing:-1px;font-size:24px;padding-bottom:3px;font-weight:400;font-family:Vera, Helvetica, Georgia;"><a title="How To Set Up a FreeBSD Router – Step-by-Step Tutorial" href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/" rel="bookmark" style="outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;border:0px none;color:rgb(44, 44, 41);font-weight:700;text-decoration:none;display:block;"><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:64px;height:24px;"><en-media type="image/png" hash="763f5009fdd43bc070728a1e7f986e1c" width="85" height="25" style="position:relative;width:85px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">How </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:36px;height:24px;"><en-media type="image/png" hash="7371b82ed6438dfd19c96a2df3b83b18" width="57" height="25" style="position:relative;width:57px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">To </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:50px;height:24px;"><en-media type="image/png" hash="6649e53212958c0dcc9316a9965c954e" width="71" height="25" style="position:relative;width:71px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">Set </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:43px;height:24px;"><en-media type="image/png" hash="74b49f35a501f96c9bb29d5503721554" width="64" height="25" style="position:relative;width:64px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">Up </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:23px;height:24px;"><en-media type="image/png" hash="0724afad29df1fbc399f3d4677891303" width="44" height="25" style="position:relative;width:44px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">a </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:116px;height:24px;"><en-media type="image/png" hash="191cc56dd9abdd467f0cb8e3751f8877" width="137" height="25" style="position:relative;width:137px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">FreeBSD </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:94px;height:24px;"><en-media type="image/png" hash="edfb8d8e2be42c88fe7ebe8275b3db89" width="115" height="25" style="position:relative;width:115px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">Router </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:19px;height:24px;"><en-media type="image/png" hash="1bb57965aab03b2b4392a70f28bd618c" width="40" height="25" style="position:relative;width:40px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">– </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:174px;height:24px;"><en-media type="image/png" hash="0a64373f25637eccc1643971e133f4c8" width="195" height="25" style="position:relative;width:195px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">Step-by-Step </span></span><span style="display:inline-block;position:relative;vertical-align:middle;font-size:1px;line-height:1px;text-indent:0px;width:96px;height:24px;"><en-media type="image/png" hash="5de51b8752200f7b3db7e4d98bd8b0c7" width="117" height="25" style="position:relative;width:117px;height:25px;top:-1px;left:-1px;"></en-media><span style="display:inline-block;width:0px;height:0px;overflow:hidden;text-indent:-10000in;">Tutorial</span></span></a></h2>
<div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;"><div style="outline:0px none currentcolor;vertical-align:baseline;padding:0px;border:1px solid rgb(238, 238, 238);background:rgb(255, 255, 255) none repeat scroll 0% 0%;margin:10px 0px;width:100%;border-radius:10px;"><div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;padding:0px;margin:10px;color:rgb(51, 51, 51);font-size:16px;line-height:20px;"><div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px 10px 0px 0px;float:left;"><a href="http://blog.up-link.ro/feed/" rel="nofollow" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);"><en-media type="image/png" hash="8c88647bedcced5bcc43a7ec80a4c6c7" alt="WP Greet Box icon" width="48" height="48" style="outline:0px none currentcolor;vertical-align:baseline;border:medium none;background:rgba(0, 0, 0, 0) none repeat scroll 0% 0%;margin:0px;padding:0px;"></en-media></a></div><div style="outline:0px none currentcolor;vertical-align:baseline;padding:0px;border:1px solid rgb(204, 204, 204);background:rgb(255, 255, 255) none repeat scroll 0% 0%;margin:0px 0px 0px 10px;float:right;height:15px;width:15px;"><a href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/#" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;padding:0px;margin:0px 3px;color:rgb(204, 204, 204);cursor:pointer;font-family:verdana;font-size:12px;font-weight:bold;line-height:14px;text-transform:uppercase;">X</a></div>Welcome <strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">Googler</strong>! If you find this page useful, you might want to <a href="http://blog.up-link.ro/feed/" rel="nofollow" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">subscribe to the RSS feed</strong></a> or <a href="http://feedburner.google.com/fb/a/mailverify?uri=bloguplinkro" rel="nofollow" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">subscribe via E-mail</strong></a> for updates on this topic.<div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;clear:both;"></div></div></div></div><p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">This tutorial explains how to set up a <strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">FreeBSD</strong> system that will act as a network router that takes advantage of the ported version of OpenBSD's PF packet filter. A network router is a system that forwards packets from one interface to another.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">1. <span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;text-decoration:underline;">FreeBSD Installation</span></strong></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Install FreeBSD by using <a href="http://blog.up-link.ro/freebsd-how-to-install-freebsd-freebsd-8-installation-guide/" target="_blank" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);">this</a> tutorial.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Now that you have FreeBSD installed, lets proceed with the next step.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">2. <span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;text-decoration:underline;">FreeBSD Network Configuration</span></strong></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Open /etc/rc.conf in your favorite editor. You need to add a line for each network card present on the system, for example in our case we'll use two network cards:<span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;"></span></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### rc.conf<br/>
# WAN connection<br/>
ifconfig_xl0="inet 10.0.0.2 netmask 255.255.255.0"<br/>
#  If you are using dhcp for WAN connection use ifconfig_xl0="dhcp"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># LAN connection<br/>
ifconfig_xl1="inet 192.168.0.1 netmask 255.255.255.0"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Default gateway<br/>
defaultrouter="10.0.0.1" # Set the gateway</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Enable ip forward<br/>
gateway_enable="YES"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Hostname<br/>
hostname="freebsd.my.domain"<br/>
### end rc.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">You have to replace xl0, xl1 with the correct device for your cards, and the addresses with the proper ones.<br/>
defaultrouter is needed only if you are not using dhpc for WAN connection.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">NOTE:</strong> If you configured the network during installation, some lines about the network cards may be already present. Double check /etc/rc.conf before adding any lines.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">You will also have to edit /etc/hosts to add the names and the IP addresses of various machines of the LAN, if they are not already there.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">127.0.0.1        localhost localhost.my.domain<br/>
192.168.0.1    freebsdrouter.my.domain freebsdrouter</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Set the DNS in /etc/resolv.conf :</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">nameserver    10.0.0.1</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">NOTE:</strong> You need to manually set up the nameserver only if you are not using dhcp for WAN connection.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">3. <span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;text-decoration:underline;">Set up DHCP Server</span></strong></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">The Dynamic Host Configuration Protocol (DHCP) is a network protocol used by hosts (DHCP clients) to retrieve IP address assignments and other configuration information. Each computer connected to a network must have a unique IP, and without DHCP TCP/IP information must be assigned manually on each computer. DHCP Server (or DHCPd) is the server that provides the DHCP client the information it needed.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">To install DHCP Server, execute the following commands:</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># cd /usr/ports/net/isc-dhcp3-server<br/>
# make install clean</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Next we will configure the DHCP service. Start off by copying a sample configuration file to /usr/local/etc.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># cp /usr/local/etc/dhcpd.conf.sample /usr/local/etc/dhcpd.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Then edit /usr/local/etc/dhcpd.conf. (local DNS server,lease time, the network gateway, and the available IP address range).  Below is an example configuration.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### dhcpd.conf<br/>
# name server<br/>
option domain-name-servers 10.0.0.1;<br/>
# lease time<br/>
default-lease-time 600;<br/>
max-lease-time 7200;</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># If this DHCP server is the official DHCP server for the local<br/>
# network, the authoritative directive should be uncommented.<br/>
authoritative;</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># ad-hoc DNS update scheme - set to "none" to disable dynamic DNS updates.<br/>
ddns-update-style none;</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Use this to send dhcp log messages to a different log file<br/>
# you also have to hack syslog.conf to complete the redirection<br/>
log-facility local7;</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># subnet declaration<br/>
subnet 192.168.0.0 netmask 255.255.255.0 {<br/>
range 192.168.0.100 192.168.0.200;<br/>
option routers 192.168.0.1;<br/>
option subnet-mask 255.255.255.0;<br/>
}<br/>
### end dhcpd.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Enable dhcp to start on boot by modifying /etc/rc.conf.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">dhcpd_enable=YES<br/>
dhcpd_ifaces="xl1" # LAN card</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">4. <span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;text-decoration:underline;">Set up FreeBSD Firewall using OpenBSD's PF packet filter</span></strong></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">A firewall (in this context) is a set of rules that allows or denies certain types of network packets from entering or leaving your FreeBSD router. This section deals with building a firewall.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">We'll use one of the example PF configuration files as a basis for our configuration.<br/>
This sample file has everything we need for a basic FreeBSD router.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># cp /usr/share/examples/pf/faq-example1 /etc/pf.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">You will need to edit /etc/pf.conf, specifying the internal and external interfaces, as well as what services you want to allow external clients to access on the FreeBSD router.  Below is the /usr/share/examples/pf/faq-example1 file with additional modifications.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### pf.conf<br/>
### macross<br/>
## internal and external interfaces<br/>
int_if = "xl1"<br/>
ext_if = "xl0"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Ports we want to allow access to from the outside world on our local system (ext_if)<br/>
tcp_services = "{ 22, 80 }"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># ping requests<br/>
icmp_types = "echoreq"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># Private networks, we are going to block incoming traffic from them<br/>
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### options<br/>
set block-policy drop<br/>
set loginterface $ext_if<br/>
set skip on lo0</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### Scrub<br/>
# From the PF user's guide (http://www.openbsd.org/faq/pf/index.html):<br/>
# "Scrubbing" is the normalization of packets so there are no ambiguities in<br/>
# interpretation by the ultimate destination of the packet. The scrub directive<br/>
# also reassembles fragmented packets, protecting some operating systems from<br/>
# some forms of attack, and # drops TCP packets that have invalid flag<br/>
# combinations.<br/>
scrub in all</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### nat/rdr<br/>
# NAT traffic from internal network to external network through external<br/>
# interface<br/>
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># redirect FTP traffic to FTP proxy on localhost:8021<br/>
# requires ftp-proxy to be enabled in /etc/inetd.conf<br/>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### filter rules<br/>
block all</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># block incoming traffic from private networks on external interface<br/>
block drop in quick on $ext_if from $priv_nets to any</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># block outgoing traffic to private networks on external interface<br/>
block drop out quick on $ext_if from any to $priv_nets</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># allow access to tcp_services on external interface<br/>
pass in on $ext_if inet proto tcp from any to ($ext_if) port<br/>
$tcp_services flags S/SA keep state</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># allow in FTP control port<br/>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) user proxy flags S/SA keep state</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># allow in ping replies<br/>
pass in inet proto icmp all icmp-type $icmp_types keep state</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># allow all traffic from internal network to internal interface<br/>
pass in  on $int_if from $int_if:network to any keep state<br/>
pass out on $int_if from any to $int_if:network keep state</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># allow all traffic out via external interface<br/>
pass out on $ext_if proto tcp all modulate state flags S/SA<br/>
pass out on $ext_if proto { udp, icmp } all keep state<br/>
### end pf.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">To test the rules from pf.conf without loading them into pf, type the following command:</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># pfctl -n -f /etc/pf.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">To activate PF, and have it start automatically on boot-up, edit your /etc/rc.conf and add the following lines:</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">### rc.conf<br/>
pf_enable="YES"                           # Enable PF (load module if required)<br/>
pf_rules="/etc/pf.conf"               # rules definition file for pf<br/>
pf_flags=""                                      # additional flags for pfctl startup<br/>
pflog_enable="YES"                     # start pflogd(8)<br/>
pflog_logfile="/var/log/pflog"  # where pflogd should store the logfile<br/>
pflog_flags=""                                 # additional flags for pflogd startup<br/>
pflogd_enable="YES"<br/>
pfsync_enable="YES"<br/>
### end rc.conf</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><strong style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;">5. <span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;text-decoration:underline;">Conclusion</span></strong></p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">This tutorial has just touched on the basics of using FreeBSD and OpenBSD's PF packet filter as a router. PF offers many advanced features such as traffic shaping and blocking hosts based on their OS. For more information see the PF handbook.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">Now you have to reboot the system for the changes to take effect.</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"># shutdown -r now</p>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;">When the system comes back up, the LAN clients should be able to access the Internet through this FreeBSD router.</p>
<a href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/print/" title="Print This Post" rel="nofollow" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);"><en-media type="image/gif" hash="873c282f3a581c7aa557fe64db214947" alt="Print This Post" title="Print This Post" width="16" height="16" style="border:0px;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;"></en-media></a> <a href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/print/" title="Print This Post" rel="nofollow" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);">Print This Post</a>


<div style="outline:0px none currentcolor;vertical-align:baseline;margin:0px;border:1px solid rgb(182, 182, 181);background:rgb(237, 237, 237) url(&amp;quot;images/rss.png&amp;quot;) no-repeat scroll 90% -35px;padding:10px 10px 5px;clear:both;margin-top:1em;opacity:0.6;">
<h3 style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;font-size:1.8em;margin-left:3px;">Enjoy this article?</h3>
<p style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:1px 0px 15px;padding:2px;font-size:1.2em;"><a href="http://blog.up-link.ro/feed/" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(128, 125, 122);">Consider subscribing to our rss feed!</a></p>
</div>


<div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;margin:0px;background:rgb(255, 255, 255) url(&amp;quot;images/wider/tags_category.png&amp;quot;) no-repeat scroll 0% 0%;padding:8px 0px 5px 10px;clear:both;margin-top:10px;width:713px;">
<span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;float:left;width:570px;">Tagged as: <a href="http://blog.up-link.ro/tag/dhcp/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">dhcp</a>, <a href="http://blog.up-link.ro/tag/dhcpd-conf/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">dhcpd.conf</a>, <a href="http://blog.up-link.ro/tag/freebsd/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">freebsd</a>, <a href="http://blog.up-link.ro/tag/howto/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">howto</a>, <a href="http://blog.up-link.ro/tag/pf/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">pf</a>, <a href="http://blog.up-link.ro/tag/pf-conf/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">pf.conf</a>, <a href="http://blog.up-link.ro/tag/rc-conf/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">rc.conf</a>, <a href="http://blog.up-link.ro/tag/resolv-conf/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">resolv.conf</a>, <a href="http://blog.up-link.ro/tag/router/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">router</a>, <a href="http://blog.up-link.ro/tag/tutorial/" rel="tag" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">tutorial</a></span>
<span style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;float:right;padding-right:15px;width:100px;text-align:center;"><a href="http://blog.up-link.ro/how-to-set-up-a-freebsd-router-step-by-step-tutorial/#respond" style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;color:rgb(44, 44, 41);">Leave a comment</a></span><div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;background:transparent none repeat scroll 0% 0%;margin:0px;padding:0px;clear:both;"></div>
</div>
<div style="border:0px none;outline:0px none currentcolor;vertical-align:baseline;margin:0px;padding:0px;background:rgb(255, 255, 255) url(&amp;quot;images/wider/tags_category.png&amp;quot;) no-repeat scroll 0px -81px;max-height:3px;height:3px;margin-bottom:20px;width:713px;"></div>

</div></div></div></div></div></div></div><br/></div></en-note>