<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note><div><span style="font-size: 24px; font-weight: bold;">Auto Login using the Public-key</span></div><div><span style="color: rgb(121, 121, 121);"># Written by KFH: </span><a href="mailto:karshi.hasanov@utoronto.ca" style="color: rgb(121, 121, 121);">karshi.hasanov@utoronto.ca</a></div><div><span style="color: rgb(121, 121, 121);"># Date: May 17, 2002</span></div><div><span style="color: rgb(121, 121, 121);"># Last Modified: July 20, 2017</span></div><div><span style="color: rgb(121, 121, 121);"># Description: Auto Login to a SSH Server using the public key.</span></div><div><br /></div><div><span style="font-style: italic; font-weight: bold;">Theory:</span></div><div> The basic idea is that there are two realted numbers, called <span style="font-style: italic; font-weight: bold;">keys</span>, such  that</div><div>a message encrypted by one can be decrypted by the other, and vice verse.</div><div>One of these keys is called the <span style="font-weight: bold;">public key</span> and the other the <span style="font-weight: bold;">private key</span>. The <span style="font-weight: bold;">public key</span> is known to everyone while the <span style="font-weight: bold;">private key</span> is known only to you.</div><div><span style="font-style: italic; text-decoration: underline;">The authentication works essentially like this:</span><span style="text-decoration: underline;"> </span>The server knows your <span style="font-weight: bold;">public key</span>, you know your <span style="font-weight: bold;">private key</span>. </div><div><br /></div><div><span style="font-size: 24px; font-weight: bold;">Permissions</span></div><div><ul><li><font style="font-size: 18px;"><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;">The </span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">.ssh</span></span><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;"> directory permissions to be </span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">700 </span>(drwx———)</span><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;"> </span></font></li><li><font style="font-size: 18px;"><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;"> The public key (</span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">.pub</span></span><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;"> file) to be<span style="font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal; font-weight: bold;"> </span></span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">644</span> (-rw-r--r--)</span></font></li><li><font style="font-size: 18px;"><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;">The private key (</span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">id_rsa</span></span><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;">) should be </span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal;"><span style="font-size: 18px; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;">600 </span>(-rw———)</span></font></li><li style="orphans: 2; widows: 2; ">Authorized_keys file needs<span style="font-weight: bold;"> 644 </span><span style="border: 0px; background-color: rgb(239, 240, 241); orphans: 2; widows: 2;"><span style="white-space: pre-wrap; background-color: rgb(239, 240, 241); color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal; font-weight: bold;"> (-rw-r--r—) </span></span>permissions:</li></ul><div>         <span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap;"><span style="background-color: rgb(239, 240, 241); font-size: 18px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-weight: bold;">chmod 644</span><span style="background-color: rgb(239, 240, 241); font-size: 18px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif;"> /home/$USER/.ssh/</span><span style="background-color: rgb(239, 240, 241); font-size: 18px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-weight: bold;">authorized_keys</span></span></div><ul><li><font style="font-size: 18px;"><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;">Lastly, your home directory should not be writeable by the group or others (at most </span><span style="border: 0px; background-color: rgb(239, 240, 241); white-space: pre-wrap; orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, sans-serif; font-variant-ligatures: normal;">755 (drwxr-xr-x)</span><span style="orphans: 2; widows: 2; font-size: 18px; color: rgb(36, 39, 41); font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-variant-ligatures: normal;">).</span></font></li></ul></div><div><br /></div><div><span style="font-size: 24px; font-weight: bold;">Client Side :</span></div><div>Generating the <span style="font-weight: bold;">public</span> - <span style="font-weight: bold;">private key</span> pair:</div><div>=&gt;<span style="font-weight: bold;"> ssh-keygen</span> -t<span style="color: rgb(148, 17, 0);"> rsa</span> -b 2048      # "rsa" for SSH v2,  "t" - type, "b" - bits</div><div>( In my iMAC this command created two files “id_rsa” and “<span style="color: rgb(79, 143, 0);">id_rsa.pub</span>” (public key))</div><div>Copy the public key "<span style="color: rgb(79, 143, 0);">id_rsa.pub</span>” to the SSH Server </div><div><br /></div><div><span style="font-size: 24px; font-weight: bold;">Server side</span> ( where you want to auto login):</div><div><br /></div><div>Edit the “<span style="color: rgb(148, 17, 0);">/etc/ssh/sshd_config</span>” file and make sure that</div><div><span style="font-weight: bold;">   <span style="font-weight: bold; color: rgb(4, 51, 255);">PubkeyAuthentication</span><span style="font-weight: bold; color: rgb(0, 144, 81);"> </span></span><span style="color: rgb(0, 144, 81); font-style: italic;">yes</span></div><div><span style="color: rgb(121, 121, 121);"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span></div><div><span style="color: rgb(121, 121, 121);">  </span><span style="color: rgb(4, 51, 255); font-weight: bold;"> AuthorizedKeysFile</span><span style="color: rgb(121, 121, 121);"> </span><span style="color: rgb(148, 17, 0);">.ssh/authorized_keys</span></div><div><span style="color: rgb(121, 121, 121);"># If you made any change to the config file, restart the server</span></div><div><br /></div><div>Get the public key from the client side and put it in the “~/.ssh/authorized_keys” file.</div><div>Suppose you have the public RSA key called “id_rsa.pub” , then:</div><div>=&gt;<span style="font-weight: bold;"> cat </span><span style="color: rgb(0, 143, 0);">id_rsa.pub</span> &gt;&gt; <span style="color: rgb(148, 17, 0);">~/.ssh/</span><span style="color: rgb(0, 150, 255);">authorized_keys</span></div><div><span style="color: rgb(192, 192, 192);">Note: The server might require</span> <span style="color: rgb(148, 17, 0);">~/.ssh/</span><span style="color: rgb(0, 150, 255);">authorized_keys2 </span><span style="color: rgb(192, 192, 192);">as well unless you tell</span></div><div><span style="color: rgb(192, 192, 192);">          it like above!</span></div><div><br /></div><div><span style="font-size: 24px; font-weight: bold;">Troubleshooting:</span></div><div>If anything go wrong, check the SSH Server log file</div><div>=&gt;<span style="font-weight: bold;"> tail -f</span> <span style="color: rgb(148, 17, 0);">/var/log/auth.log</span>  <span style="color: rgb(121, 121, 121);"># The location of the SSH Server might be different in  your system.</span></div><div><br /></div><div><span style="color: rgb(255, 47, 146);">Warning: If you are running your own DNS Server, make sure that your DNS can resolve the</span></div><div><span style="color: rgb(255, 47, 146);">               forward as well as the reverse zones. Otherewise, when you try to login it will hang forever.</span></div><div><span style="color: rgb(255, 47, 146);">               Or you have to tell the SSH Server ( /etc/ssh/sshd_config ) do not NOT force the reverse </span></div><div><span style="color: rgb(255, 47, 146);">               nslookup. I would NOT do the second option for the security reason.</span></div><div><br /></div><div><br /></div><div><span style="font-size: 24px; font-weight: bold; text-decoration: underline;">SSH Tips</span></div><div><br /></div><div><span style="font-weight: bold; text-decoration: underline;">Running Commands on as Remote Server</span></div><div><br /></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>    <span style="font-weight: bold;">df -h </span></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">'df -h'</span></div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">"df -h" </span></div><div><br /></div><div># If you want to save the results in a local file, use "&gt;"</div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span>  <span style="font-weight: bold;">'df -h'  &gt; </span>remote_df.txt</div><div><br /></div><div># You can run multiple commands or use the pipes:</div><div>=&gt; <span style="font-weight: bold;">ssh</span> khasanov@<span style="font-style: italic;">vm-freebsd</span> <span style="font-weight: bold;">'cat </span><span style="font-style: italic;">/etc/rc.conf '  </span><span style="font-style: italic; font-weight: bold;"> </span><span style="font-weight: bold;">|</span>  <span style="font-weight: bold;">grep</span> <span style="font-style: italic;">inetd_enable</span> </div><div><br /></div><div><br /></div><div><span style="font-weight: bold;">How To Dump the contents of a File Remotely</span></div><div><br /></div><div>Example: We want to transfer a file, called “<span style="font-weight: bold;">id_rsa.pub</span>", to a Remote SSH Server:</div><div>Client PC : The location of the file is "<span style="font-style: italic;">/home/khasanov/.ssh</span>"</div><div>Remote Server:  <a href="http://www.karshi.ca">www.karshi.ca</a> </div><div>We want to add the contents of the file at the end of the "authorized_keys" which is</div><div>located remote "<span style="font-style: italic;">/home/khasanov/.ssh/</span><span style="font-weight: bold;">authorized_keys</span>"</div><div><br /></div><div>Note: The single or double quotes means the output of the pipe will apply to the remote one.</div><div>For example: “ | “ means whatever output you get from the command before this will be forwarded to the </div><div>remote as an input.</div><div><br /></div><div>Method 1:=&gt; ssh  <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt; id_rsa.pub "|" dd  of=<span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 2:=&gt; ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt;  id_rsa.pub "&gt;" <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 3:=&gt; ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat &lt;  id_rsa.pub - "&gt;"  <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 4:=&gt; cat id_rsa.pub | ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> cat "&gt;"  <span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div>Method 5:=&gt; dd if=id_rsa.pub | ssh <a href="mailto:khasanov@karshi.ca">khasanov@karshi.ca</a> dd  of=<span style="font-style: italic;">/home/khasanov/</span>.ssh/authorized_keys</div><div><br /></div><div><br /></div></en-note>